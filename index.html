<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TORNADO V10.0 | TITAN MAXIMUM EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        /* --- –¶–í–ï–¢–û–í–ê–Ø –ü–ê–õ–ò–¢–†–ê TITAN ---
           –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª—É–±–æ–∫–∏–µ —Ç–µ–º–Ω—ã–µ —Ç–æ–Ω–∞ —Å –Ω–µ–æ–Ω–æ–≤—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏
        */
        :root {
            --accent: #00f2ff; 
            --pink: #ff007b; 
            --gold: #ffcc00; 
            --green: #00ff88;
            --bg: #030507; 
            --card: rgba(10, 15, 20, 0.98); 
            --border: rgba(0, 242, 255, 0.2);
            --neon-glow: 0 0 20px rgba(0, 242, 255, 0.4);
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; transition: var(--transition); outline: none; }

        body {
            font-family: 'Inter', sans-serif; 
            background: var(--bg); 
            color: #fff;
            margin: 0; 
            height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, #0a1018 0%, #030507 100%);
        }

        /* –§–æ–Ω–æ–≤—ã–π —Ö–æ–ª—Å—Ç –¥–ª—è —á–∞—Å—Ç–∏—Ü */
        #bgCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.4;
        }

        .app-container { 
            display: grid; 
            grid-template-columns: 1fr 420px; 
            gap: 25px; 
            width: 98vw; 
            height: 96vh; 
            max-width: 1900px; 
            padding: 15px; 
            z-index: 10;
        }

        .glass-panel { 
            background: var(--card); 
            border: 1px solid var(--border); 
            border-radius: 35px; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            backdrop-filter: blur(40px); 
            box-shadow: 0 25px 80px rgba(0,0,0,0.9); 
        }

        /* --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ---
           –ë–ª–æ–∫ –≤—Ö–æ–¥–∞ —Å –Ω–µ–æ–Ω–æ–≤–æ–π —Ä–∞–º–∫–æ–π
        */
        #authBox { 
            width: 500px; 
            padding: 70px; 
            text-align: center; 
            position: absolute; 
            z-index: 999999; 
            border: 1px solid var(--accent); 
            box-shadow: var(--neon-glow); 
            background: var(--card);
            border-radius: 40px;
        }

        .auth-nav { display: flex; gap: 15px; margin-bottom: 35px; background: rgba(255,255,255,0.03); padding: 8px; border-radius: 20px; }
        .auth-tab { flex: 1; padding: 15px; border-radius: 15px; cursor: pointer; font-size: 12px; font-weight: 900; color: #5d727b; text-transform: uppercase; letter-spacing: 1px; }
        .auth-tab.active { background: var(--accent); color: #000; box-shadow: var(--neon-glow); }

        /* --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
        */
        .sidebar-nav { 
            display: flex; 
            background: rgba(0,0,0,0.6); 
            padding: 20px; 
            gap: 12px; 
            border-bottom: 1px solid var(--border); 
            overflow-x: auto; 
            scrollbar-width: none; 
        }
        .nav-btn { 
            padding: 14px 28px; 
            border-radius: 18px; 
            cursor: pointer; 
            font-size: 11px; 
            font-weight: 800; 
            text-transform: uppercase; 
            color: #5d727b; 
            white-space: nowrap; 
            border: 1px solid transparent; 
            background: rgba(255,255,255,0.02);
        }
        .nav-btn:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-btn.active { 
            background: rgba(0, 242, 255, 0.1); 
            color: var(--accent); 
            border-color: var(--accent); 
            box-shadow: inset 0 0 15px rgba(0, 242, 255, 0.1);
        }

        .viewport { flex: 1; overflow-y: auto; padding: 40px; display: none; flex-direction: column; gap: 30px; }
        .viewport.active { display: flex; animation: viewIn 0.5s cubic-bezier(0.23, 1, 0.32, 1); }
        @keyframes viewIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- –ì–†–ê–§–ò–ö –ö–†–ê–®–ê ---
        */
        .crash-area { 
            height: 420px; 
            background: #020305; 
            border-radius: 30px; 
            position: relative; 
            overflow: hidden; 
            border: 1px solid var(--border); 
        }
        #crashCanvas { width: 100%; height: 100%; }
        .crash-info { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; z-index: 100; }
        #crashMult { font-family: 'Orbitron'; font-size: 6.5rem; font-weight: 900; text-shadow: 0 0 50px var(--accent); margin: 0; color: #fff; }

        /* --- –ú–ò–ù–´ (MINES) ---
        */
        .mines-grid { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 18px; 
            width: 100%; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 25px; 
            background: rgba(0,0,0,0.3);
            border-radius: 35px;
            border: 1px solid var(--border);
        }
        .game-cell { 
            aspect-ratio: 1; 
            background: rgba(255,255,255,0.03); 
            border: 1px solid var(--border); 
            border-radius: 22px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 36px; 
            position: relative;
        }
        .game-cell:hover { background: rgba(0, 242, 255, 0.1); border-color: var(--accent); transform: scale(1.05); }
        .game-cell.active { background: var(--accent); box-shadow: 0 0 35px var(--accent); color: #000; border: none; animation: pop 0.3s; }
        .game-cell.death { background: var(--pink); box-shadow: 0 0 35px var(--pink); color: #fff; border: none; animation: shake 0.4s; }
        
        @keyframes pop { 0% {transform:scale(0.8);} 100% {transform:scale(1);} }
        @keyframes shake { 0%, 100% {transform:translateX(0);} 25% {transform:translateX(-5px);} 75% {transform:translateX(5px);} }

        /* --- –ò–ù–¢–ï–†–§–ï–ô–° –£–ü–†–ê–í–õ–ï–ù–ò–Ø ---
        */
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .field { 
            background: rgba(0,0,0,0.7); 
            border: 1px solid var(--border); 
            padding: 22px; 
            border-radius: 22px; 
            color: #fff; 
            font-family: 'Orbitron'; 
            font-size: 18px; 
            width: 100%; 
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }
        .field:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); }
        
        .btn-ui { 
            border: none; 
            padding: 24px; 
            border-radius: 22px; 
            font-weight: 900; 
            cursor: pointer; 
            text-transform: uppercase; 
            font-family: 'Orbitron'; 
            font-size: 14px; 
            letter-spacing: 2px; 
        }
        .btn-accent { background: linear-gradient(135deg, var(--accent), #0072ff); color: #000; box-shadow: 0 10px 30px rgba(0, 242, 255, 0.3); }
        .btn-accent:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(0, 242, 255, 0.5); }
        .btn-green { background: linear-gradient(135deg, var(--green), #00b35d); color: #000; }
        .btn-disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

        /* --- –ß–ê–¢ TITAN ---
        */
        .chat-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; background: rgba(0,0,0,0.3); border-top: 1px solid var(--border); }
        #chatBox { 
            flex: 1; 
            overflow-y: auto; 
            padding: 25px; 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            scroll-behavior: smooth;
        }
        .msg { 
            background: rgba(255,255,255,0.04); 
            padding: 14px 20px; 
            border-radius: 20px; 
            font-size: 14px; 
            line-height: 1.5; 
            border-left: 5px solid var(--accent); 
            align-self: flex-start; 
            max-width: 92%; 
            animation: msgIn 0.3s ease;
        }
        @keyframes msgIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .msg b { color: var(--accent); font-family: 'Orbitron'; font-size: 11px; display: block; margin-bottom: 6px; letter-spacing: 1px; }

        /* --- –ü–†–û–ì–†–ï–°–° –ò –ë–ê–õ–ê–ù–° ---
        */
        .user-block { padding: 40px; text-align: center; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(0,242,255,0.08) 0%, transparent 100%); }
        .bal-display { font-family: 'Orbitron'; font-size: 3.2rem; font-weight: 900; color: var(--accent); text-shadow: 0 0 20px rgba(0, 242, 255, 0.4); margin-bottom: 15px; }
        .xp-line { height: 12px; background: rgba(255,255,255,0.05); border-radius: 20px; overflow: hidden; margin: 20px 0; border: 1px solid rgba(255,255,255,0.1); }
        .xp-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--green)); box-shadow: 0 0 15px var(--accent); transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        #notif { position: fixed; top: 30px; right: 30px; z-index: 1000000; display: flex; flex-direction: column; gap: 15px; }
        .toast { background: rgba(15, 20, 25, 0.98); border: 1px solid var(--accent); padding: 20px 35px; border-radius: 20px; font-weight: 700; color: #fff; box-shadow: 0 20px 50px rgba(0,0,0,0.8); animation: slideIn 0.4s forwards; }
        @keyframes slideIn { from { transform: translateX(150%); } to { transform: translateX(0); } }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –°–ø–∏—Å–∫–∞ –ª–∏–¥–µ—Ä–æ–≤ */
        .leader-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            border: 1px solid var(--border);
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>
<div id="notif"></div>

<div id="authBox" class="glass-panel">
    <h1 style="font-family:'Orbitron'; font-size: 3.5rem; margin:0; color:var(--accent); letter-spacing: 5px;">TORNADO</h1>
    <p style="letter-spacing: 12px; font-size: 12px; color: #5d727b; margin-bottom: 45px; font-weight: 900;">TITAN V10.0 MAXIMUM</p>
    
    <div class="auth-nav">
        <div class="auth-tab active" id="tabLogin" onclick="setAuth('login')">–í—Ö–æ–¥</div>
        <div class="auth-tab" id="tabReg" onclick="setAuth('reg')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
    </div>
    
    <input type="text" id="authUser" placeholder="–õ–û–ì–ò–ù –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø" class="field" style="margin-bottom: 20px;">
    <input type="password" id="authPass" placeholder="–ü–ê–†–û–õ–¨ –¢–ò–¢–ê–ù–ê" class="field" style="margin-bottom: 35px;">
    
    <button class="btn-ui btn-accent" style="width:100%" onclick="handleAuth()">–ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø</button>
</div>

<div class="app-container" id="mainApp" style="display: none;">
    <div class="glass-panel">
        <div class="sidebar-nav">
            <div class="nav-btn active" onclick="showTab(this, 'viewCrash')">üìà CRASH</div>
            <div class="nav-btn" onclick="showTab(this, 'viewMines')">üí£ MINES</div>
            <div class="nav-btn" onclick="showTab(this, 'viewLadder')">ü™ú LADDER</div>
            <div class="nav-btn" onclick="showTab(this, 'viewMining')">‚ö° MINING</div>
            <div class="nav-btn" onclick="showTab(this, 'viewCases')">üì¶ CASES</div>
            <div class="nav-btn" onclick="showTab(this, 'viewTop')">üèÜ LEADERS</div>
        </div>

        <div id="viewCrash" class="viewport active">
            <div class="crash-area">
                <canvas id="crashCanvas"></canvas>
                <div class="crash-info">
                    <div id="crashMult">1.00x</div>
                    <div id="crashProfit" style="color:var(--green); font-family:'Orbitron'; font-size:2.2rem; margin-top:10px; height:40px; font-weight:900;"></div>
                </div>
            </div>
            <div class="input-row">
                <div style="display:flex; flex-direction:column; gap:10px;">
                    <label style="font-size:10px; color:#5d727b; margin-left:10px;">–°–£–ú–ú–ê –°–¢–ê–í–ö–ò</label>
                    <input type="number" id="betCrash" value="100" class="field">
                </div>
                <div style="display:flex; flex-direction:column; gap:10px;">
                    <label style="font-size:10px; color:#5d727b; margin-left:10px;">–ê–í–¢–û-–í–´–í–û–î</label>
                    <input type="number" id="autoCrash" placeholder="2.00" class="field">
                </div>
            </div>
            <button id="btnCrash" class="btn-ui btn-accent" onclick="actionCrash()">–°–î–ï–õ–ê–¢–¨ –°–¢–ê–í–ö–£</button>
        </div>

        <div id="viewMines" class="viewport">
            <div class="input-row">
                <input type="number" id="betMines" value="100" placeholder="–°–¢–ê–í–ö–ê" class="field">
                <select id="cntMines" class="field" style="background:#050709;">
                    <option value="3">3 –ú–ò–ù–´</option>
                    <option value="5">5 –ú–ò–ù</option>
                    <option value="10">10 –ú–ò–ù</option>
                    <option value="24">24 –ú–ò–ù–´ (JACKPOT)</option>
                </select>
            </div>
            <div id="gridMines" class="mines-grid"></div>
            <button id="btnMines" class="btn-ui btn-accent" onclick="toggleMines()">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
        </div>

        <div id="viewLadder" class="viewport">
            <div class="input-row">
                <input type="number" id="betLadder" value="100" class="field">
                <select id="stepLadder" class="field" style="background:#050709;">
                    <option value="5">–ù–ò–ó–ö–ê–Ø (5)</option>
                    <option value="8" selected>–°–†–ï–î–ù–Ø–Ø (8)</option>
                    <option value="12">–í–´–°–û–ö–ê–Ø (12)</option>
                </select>
            </div>
            <div id="areaLadder" style="display:flex; flex-direction:column-reverse; gap:12px; margin-top:20px;"></div>
            <button id="startLadder" class="btn-ui btn-accent" onclick="initLadder()">–ù–ê–ß–ê–¢–¨ –ü–û–î–™–ï–ú</button>
        </div>

        <div id="viewMining" class="viewport">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:30px;">
                <button class="btn-ui btn-accent" style="height:220px; font-size:24px;" onclick="clickFarm()">
                    –ë–ò–¢–¨ –ü–û –ë–õ–û–ö–£<br><span id="valClick" style="font-size:14px; opacity:0.8; margin-top:15px; display:block;">+0.00 ‚ÇΩ</span>
                </button>
                <div class="glass-panel" style="justify-content:center; align-items:center; background:rgba(255,255,255,0.02); border:1px solid var(--border);">
                    <p style="font-size:12px; color:#5d727b; letter-spacing:2px; font-weight:800;">–¢–ï–ö–£–©–ò–ô –•–≠–®–†–ï–ô–¢</p>
                    <h1 id="valPassive" style="color:var(--green); font-size:3.5rem; margin:15px 0; font-family:'Orbitron';">0 ‚ÇΩ</h1>
                    <p style="font-size:10px; font-weight:800;">–í –°–ï–ö–£–ù–î–£ (PASSIVE)</p>
                </div>
            </div>
            <div id="listGPU" style="margin-top:20px; display:flex; flex-direction:column; gap:15px;"></div>
        </div>

        <div id="viewCases" class="viewport">
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap:30px;">
                <div class="glass-panel" style="padding:40px; text-align:center; border: 1px solid var(--border);">
                    <h2 style="font-family:'Orbitron'; color:var(--accent); margin-bottom:10px;">BRONZE BOX</h2>
                    <p style="color:#5d727b; margin-bottom:35px; font-size:13px;">WIN UP TO 10,000 ‚ÇΩ</p>
                    <button id="caseBtn1" class="btn-ui btn-accent" style="width:100%" onclick="openBox(1000, 200, 10000, 'caseBtn1')">–û–¢–ö–†–´–¢–¨ –ó–ê 1,000</button>
                </div>
                <div class="glass-panel" style="padding:40px; text-align:center; border: 1px solid var(--gold);">
                    <h2 style="font-family:'Orbitron'; color:var(--gold); margin-bottom:10px;">TITAN CASE</h2>
                    <p style="color:#5d727b; margin-bottom:35px; font-size:13px;">WIN UP TO 500,000 ‚ÇΩ</p>
                    <button id="caseBtn2" class="btn-ui btn-accent" style="width:100%; background:var(--gold);" onclick="openBox(25000, 5000, 500000, 'caseBtn2')">–û–¢–ö–†–´–¢–¨ –ó–ê 25,000</button>
                </div>
            </div>
            <div id="boxResCont" style="margin-top:50px; text-align:center;">
                <h1 id="boxRes" style="font-family:'Orbitron'; font-size:5rem; letter-spacing:8px; min-height:80px;"></h1>
            </div>
        </div>

        <div id="viewTop" class="viewport">
            <h1 style="font-family:'Orbitron'; text-align:center; font-size:3rem; color:var(--gold); margin-bottom:40px;">TITAN HALL OF FAME</h1>
            <div id="listTop" style="display:flex; flex-direction:column; gap:15px;"></div>
        </div>
    </div>

    <div class="glass-panel">
        <div class="user-block">
            <div class="bal-display" id="uBalance">0 ‚ÇΩ</div>
            <div class="xp-line"><div class="xp-bar" id="uBar"></div></div>
            <div style="display:flex; justify-content:space-between; font-size:11px; font-weight:900; color:#5d727b; text-transform:uppercase; letter-spacing:1px;">
                <span id="uLevel">LEVEL 1</span>
                <span id="uXP">0 / 1000 XP</span>
            </div>
        </div>
        
        <div class="chat-container">
            <div id="chatBox"></div>
            <div style="padding:25px; display:flex; gap:12px; background: rgba(0,0,0,0.5);">
                <input type="text" id="chatInput" placeholder="–¢–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï..." class="field" style="padding:15px; font-size:14px;">
                <button class="btn-ui btn-accent" style="padding:0 30px;" onclick="sendMsg()">></button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
    /*
       --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ---
       –ò—Å–ø–æ–ª—å–∑—É–µ–º Realtime Database –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —á–∞—Ç–∞
    */
    const firebaseConfig = {
        apiKey: "AIzaSyC8UkaoaI7nHRSxNPddRwXnNxzHX7kt8s8",
        databaseURL: "https://tornadogame-41ae2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "tornadogame-41ae2",
        appId: "1:926174944730:web:20be5b57efb23ab853b4e3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ---
    let user = null, userData = {}, authMode = 'login', audioCtx;
    let crash = { active: false, mult: 1.0, bet: 0, cashed: false, pts: [] };
    let mines = { active: false, bet: 0, bombs: [], open: 0, total: 3 };
    let ladder = { active: false, bet: 0, step: 0, max: 8 };
    let isCaseOpening = false;

    // --- –ö–û–ù–°–¢–ê–ù–¢–´ –ú–ê–ô–ù–ò–ù–ì–ê ---
    const GPUS = [
        {id:'g1', n:'GTX 1050 Ti', p:20000, i:25},
        {id:'g2', n:'RTX 3060', p:120000, i:185},
        {id:'g3', n:'RTX 4090 SUPER', p:2500000, i:4800},
        {id:'g4', n:'ANTMINER S21', p:12000000, i:25000},
        {id:'g5', n:'QUANTUM TITAN CORE', p:75000000, i:180000}
    ];

    // --- –°–ò–°–¢–ï–ú–ê –ß–ê–°–¢–ò–¶ (BACKGROUND) ---
    const bgCvs = document.getElementById('bgCanvas');
    const bgCtx = bgCvs.getContext('2d');
    let particles = [];

    function initParticles() {
        bgCvs.width = window.innerWidth;
        bgCvs.height = window.innerHeight;
        for(let i=0; i<60; i++) {
            particles.push({
                x: Math.random()*bgCvs.width,
                y: Math.random()*bgCvs.height,
                s: Math.random()*2 + 1,
                v: Math.random()*0.5 + 0.2
            });
        }
    }

    function drawParticles() {
        bgCtx.clearRect(0,0,bgCvs.width, bgCvs.height);
        bgCtx.fillStyle = '#00f2ff';
        particles.forEach(p => {
            bgCtx.beginPath();
            bgCtx.arc(p.x, p.y, p.s, 0, Math.PI*2);
            bgCtx.fill();
            p.y -= p.v;
            if(p.y < -10) p.y = bgCvs.height + 10;
        });
        requestAnimationFrame(drawParticles);
    }
    initParticles(); drawParticles();

    // --- –ó–í–£–ö–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê ---
    function sfx(freq, type='sine', dur=0.2, vol=0.1) {
        try {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + dur);
        } catch(e) {}
    }

    // --- –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ---
    function toast(txt) {
        const container = document.getElementById('notif');
        const el = document.createElement('div');
        el.className = 'toast';
        el.innerText = txt;
        container.appendChild(el);
        setTimeout(() => { el.style.opacity = '0'; setTimeout(() => el.remove(), 500); }, 3500);
    }

    // --- –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø (LOGIC) ---
    function setAuth(mode) {
        authMode = mode;
        document.getElementById('tabLogin').classList.toggle('active', mode==='login');
        document.getElementById('tabReg').classList.toggle('active', mode==='reg');
    }

    function handleAuth() {
        const u = document.getElementById('authUser').value.trim().toLowerCase();
        const p = document.getElementById('authPass').value.trim();
        if(u.length < 3) return toast("–ú–ò–ù–ò–ú–£–ú 3 –°–ò–ú–í–û–õ–ê!");
        
        db.ref('users/' + u).once('value', snapshot => {
            if(authMode === 'login') {
                if(snapshot.exists() && snapshot.val().pass === p) {
                    sfx(600); runSession(u);
                } else toast("–û–®–ò–ë–ö–ê –î–û–°–¢–£–ü–ê!");
            } else {
                if(snapshot.exists()) toast("–õ–û–ì–ò–ù –£–ñ–ï –í –°–ï–¢–ò!");
                else {
                    db.ref('users/' + u).set({
                        pass: p,
                        balance: 15000,
                        xp: 0,
                        lvl: 1,
                        gpus: {}
                    }).then(() => runSession(u));
                }
            }
        });
    }

    function runSession(userId) {
        user = userId;
        document.getElementById('authBox').style.display = 'none';
        document.getElementById('mainApp').style.display = 'grid';
        
        // –°–ª—É—à–∞—Ç–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        db.ref('users/' + user).on('value', snap => {
            userData = snap.val();
            updateInterface();
        });

        // –°–ª—É—à–∞—Ç–µ–ª—å —á–∞—Ç–∞
        db.ref('chat').limitToLast(40).on('value', snap => {
            const box = document.getElementById('chatBox');
            box.innerHTML = '';
            snap.forEach(m => {
                const div = document.createElement('div');
                div.className = 'msg';
                div.innerHTML = `<b>${m.val().u.toUpperCase()}</b>${m.val().t}`;
                box.appendChild(div);
            });
            box.scrollTop = box.scrollHeight;
        });

        initCrashEngine();
        syncLeaderboard();
        
        // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
        setInterval(() => {
            let totalIncome = 0;
            if(userData.gpus) {
                GPUS.forEach(g => {
                    totalIncome += (userData.gpus[g.id] || 0) * g.i;
                });
            }
            if(totalIncome > 0) {
                db.ref('users/'+user+'/balance').transaction(b => (b || 0) + totalIncome);
            }
        }, 1000);
    }

    function updateInterface() {
        document.getElementById('uBalance').innerText = Math.floor(userData.balance).toLocaleString() + ' ‚ÇΩ';
        const nextXp = userData.lvl * 1500;
        document.getElementById('uBar').style.width = (userData.xp / nextXp * 100) + '%';
        document.getElementById('uLevel').innerText = 'LEVEL ' + userData.lvl;
        document.getElementById('uXP').innerText = `${userData.xp} / ${nextXp} XP`;
        document.getElementById('valClick').innerText = `+${(userData.lvl * 5).toFixed(2)} ‚ÇΩ`;
        
        let p = 0; if(userData.gpus) GPUS.forEach(g => p += (userData.gpus[g.id]||0)*g.i);
        document.getElementById('valPassive').innerText = p.toLocaleString() + ' ‚ÇΩ';
    }

    // --- CRASH ENGINE V10 ---
    const crashCvs = document.getElementById('crashCanvas');
    const crashCtx = crashCvs.getContext('2d');

    function initCrashEngine() {
        crash.active = false; crash.mult = 1.0; crash.cashed = false; crash.pts = [];
        const btn = document.getElementById('btnCrash');
        btn.innerText = "–°–î–ï–õ–ê–¢–¨ –°–¢–ê–í–ö–£"; btn.className = 'btn-ui btn-accent';
        document.getElementById('crashProfit').innerText = '';
        
        let timer = 8;
        let itv = setInterval(() => {
            timer--;
            document.getElementById('crashMult').innerText = timer + 's';
            if(timer <= 0) {
                clearInterval(itv);
                launchCrash();
            }
        }, 1000);
    }

    function launchCrash() {
        crash.active = true;
        crash.cashed = false;
        crashCvs.width = crashCvs.offsetWidth;
        crashCvs.height = crashCvs.offsetHeight;
        
        let crashPoint = (Math.random() < 0.1) ? 1.0 : (Math.random() * 7 + 1.1);
        let startTime = Date.now();
        
        if(crash.bet > 0) {
            const btn = document.getElementById('btnCrash');
            btn.innerText = "–í–´–í–ï–°–¢–ò –°–†–ï–î–°–¢–í–ê"; btn.className = 'btn-ui btn-green';
        }

        let loop = setInterval(() => {
            let elapsed = (Date.now() - startTime) / 1000;
            crash.mult = Math.pow(1.07, elapsed).toFixed(2);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞
            crashCtx.clearRect(0,0,crashCvs.width, crashCvs.height);
            crashCtx.strokeStyle = '#00f2ff';
            crashCtx.lineWidth = 5;
            crashCtx.shadowBlur = 15;
            crashCtx.shadowColor = '#00f2ff';
            
            let posX = (elapsed / 10) * crashCvs.width;
            let posY = crashCvs.height - ((crash.mult - 1) / 4) * crashCvs.height;
            crash.pts.push({x: posX, y: posY});
            
            crashCtx.beginPath();
            crashCtx.moveTo(0, crashCvs.height);
            crash.pts.forEach(p => crashCtx.lineTo(p.x, p.y));
            crashCtx.stroke();

            if(crash.mult >= crashPoint) {
                clearInterval(loop);
                crash.active = false;
                document.getElementById('crashMult').innerText = 'CRASH!';
                document.getElementById('crashMult').style.color = 'var(--pink)';
                sfx(100, 'sawtooth', 0.5);
                crash.bet = 0;
                setTimeout(() => {
                    document.getElementById('crashMult').style.color = '#fff';
                    initCrashEngine();
                }, 3000);
            } else {
                document.getElementById('crashMult').innerText = crash.mult + 'x';
                if(crash.bet > 0 && !crash.cashed) {
                    document.getElementById('crashProfit').innerText = '+' + Math.floor(crash.bet * crash.mult) + ' ‚ÇΩ';
                    // –ê–≤—Ç–æ-–≤—ã–≤–æ–¥
                    let auto = parseFloat(document.getElementById('autoCrash').value);
                    if(auto > 1.05 && crash.mult >= auto) actionCrash();
                }
            }
        }, 60);
    }

    function actionCrash() {
        if(!crash.active) {
            let amount = parseInt(document.getElementById('betCrash').value);
            if(amount > 0 && amount <= userData.balance) {
                crash.bet = amount;
                db.ref('users/'+user+'/balance').transaction(b => b - amount);
                document.getElementById('btnCrash').innerText = "–û–ñ–ò–î–ê–ù–ò–ï...";
                document.getElementById('btnCrash').classList.add('btn-disabled');
            } else toast("–ú–ê–õ–û –°–†–ï–î–°–¢–í!");
        } else if(crash.bet > 0 && !crash.cashed) {
            crash.cashed = true;
            let winAmount = Math.floor(crash.bet * crash.mult);
            db.ref('users/'+user).transaction(u => {
                if(u) { u.balance += winAmount; u.xp += 50; }
                return u;
            });
            document.getElementById('btnCrash').innerText = "–í–´–ò–ì–†–ê–ù–û!";
            document.getElementById('btnCrash').classList.add('btn-disabled');
            document.getElementById('crashProfit').innerText = '';
            sfx(800, 'sine', 0.3);
            toast(`+ ${winAmount} ‚ÇΩ`);
        }
    }

    // --- MINES LOGIC (FIXED) ---
    function toggleMines() {
        if(mines.active) return cashoutMines();
        
        let amount = parseInt(document.getElementById('betMines').value);
        if(amount > 0 && amount <= userData.balance) {
            db.ref('users/'+user+'/balance').transaction(b => b - amount);
            mines.active = true;
            mines.bet = amount;
            mines.open = 0;
            mines.total = parseInt(document.getElementById('cntMines').value);
            mines.bombs = [];
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–º–±
            while(mines.bombs.length < mines.total) {
                let r = Math.floor(Math.random() * 25);
                if(!mines.bombs.includes(r)) mines.bombs.push(r);
            }
            
            // –°–µ—Ç–∫–∞
            const grid = document.getElementById('gridMines');
            grid.innerHTML = '';
            for(let i=0; i<25; i++) {
                const cell = document.createElement('div');
                cell.className = 'game-cell';
                cell.onclick = () => openMinesCell(i, cell);
                grid.appendChild(cell);
            }
            document.getElementById('btnMines').innerText = "–ó–ê–ë–†–ê–¢–¨ 1.00x";
        } else toast("–û–®–ò–ë–ö–ê –°–¢–ê–í–ö–ò!");
    }

    function openMinesCell(idx, el) {
        if(!mines.active || el.classList.contains('active')) return;
        
        if(mines.bombs.includes(idx)) {
            // –í–∑—Ä—ã–≤
            mines.active = false;
            el.classList.add('death');
            el.innerText = 'üí£';
            sfx(150, 'sawtooth', 0.6);
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–æ–º–±—ã
            const cells = document.querySelectorAll('.game-cell');
            mines.bombs.forEach(b => {
                cells[b].classList.add('death');
                cells[b].innerText = 'üí£';
            });
            
            setTimeout(() => {
                document.getElementById('gridMines').innerHTML = '';
                document.getElementById('btnMines').innerText = "–ù–ê–ß–ê–¢–¨ –ò–ì–†–£";
            }, 2500);
        } else {
            // –£—Å–ø–µ—Ö
            el.classList.add('active');
            el.innerText = 'üíé';
            mines.open++;
            sfx(400 + (mines.open*50));
            
            let mult = (1 + (mines.open * (mines.total / 10))).toFixed(2);
            document.getElementById('btnMines').innerText = `–ó–ê–ë–†–ê–¢–¨ ${mult}x`;
            
            if(mines.open === (25 - mines.total)) cashoutMines();
        }
    }

    function cashoutMines() {
        if(!mines.active || mines.open === 0) return;
        let mult = (1 + (mines.open * (mines.total / 10)));
        let win = Math.floor(mines.bet * mult);
        
        db.ref('users/'+user).transaction(u => {
            if(u) { u.balance += win; u.xp += 30; }
            return u;
        });
        
        mines.active = false;
        toast(`–í–´–ò–ì–†–´–®: ${win} ‚ÇΩ`);
        sfx(1000);
        document.getElementById('gridMines').innerHTML = '';
        document.getElementById('btnMines').innerText = "–ù–ê–ß–ê–¢–¨ –ò–ì–†–£";
    }

    // --- LADDER LOGIC ---
    function initLadder() {
        let b = parseInt(document.getElementById('betLadder').value);
        if(b > 0 && b <= userData.balance) {
            db.ref('users/'+user+'/balance').transaction(v => v - b);
            ladder.active = true; ladder.bet = b; ladder.step = 0;
            ladder.max = parseInt(document.getElementById('stepLadder').value);
            
            const area = document.getElementById('areaLadder');
            area.innerHTML = '';
            for(let i=0; i<ladder.max; i++) {
                const row = document.createElement('div');
                row.className = 'ladder-row';
                row.id = `l-row-${i}`;
                for(let j=0; j<2; j++) {
                    const c = document.createElement('div');
                    c.className = 'game-cell';
                    c.style.width = '160px'; c.style.height = '60px';
                    c.innerText = '?';
                    if(i === 0) c.onclick = () => stepUp(i, c);
                    else { c.style.opacity = '0.2'; c.style.cursor = 'default'; }
                    row.appendChild(c);
                }
                area.appendChild(row);
            }
            document.getElementById('startLadder').innerText = "CASH OUT 1.00x";
            document.getElementById('startLadder').onclick = cashLadder;
        }
    }

    function stepUp(idx, el) {
        if(!ladder.active || idx !== ladder.step) return;
        if(Math.random() < 0.45) {
            ladder.active = false;
            el.classList.add('death'); el.innerText = 'LOSER';
            sfx(100, 'sawtooth');
            setTimeout(() => {
                document.getElementById('areaLadder').innerHTML = '';
                document.getElementById('startLadder').innerText = "–ù–ê–ß–ê–¢–¨ –ü–û–î–™–ï–ú";
                document.getElementById('startLadder').onclick = initLadder;
            }, 2000);
        } else {
            el.classList.add('active'); el.innerText = 'SAFE';
            ladder.step++;
            sfx(500 + (ladder.step*60));
            let m = Math.pow(1.85, ladder.step).toFixed(2);
            document.getElementById('startLadder').innerText = `–ó–ê–ë–†–ê–¢–¨ ${m}x`;
            
            if(ladder.step < ladder.max) {
                const nextRow = document.getElementById(`l-row-${ladder.step}`);
                Array.from(nextRow.children).forEach(child => {
                    child.style.opacity = '1';
                    child.style.cursor = 'pointer';
                    child.onclick = () => stepUp(ladder.step, child);
                });
            } else cashLadder();
        }
    }

    function cashLadder() {
        if(!ladder.active || ladder.step === 0) return;
        let win = Math.floor(ladder.bet * Math.pow(1.85, ladder.step));
        db.ref('users/'+user).transaction(u => { if(u){u.balance += win; u.xp += 100;} return u; });
        ladder.active = false;
        document.getElementById('areaLadder').innerHTML = '';
        document.getElementById('startLadder').innerText = "–ù–ê–ß–ê–¢–¨ –ü–û–î–™–ï–ú";
        document.getElementById('startLadder').onclick = initLadder;
        toast(`–ü–û–î–™–ï–ú –ó–ê–í–ï–†–®–ï–ù: +${win} ‚ÇΩ`);
    }

    // --- CASE SYSTEM ---
    function openBox(cost, min, max, btnId) {
        if(isCaseOpening || userData.balance < cost) return toast("–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–†–ï–î–°–¢–í!");
        
        isCaseOpening = true;
        const btn = document.getElementById(btnId);
        btn.classList.add('btn-disabled');
        
        db.ref('users/'+user+'/balance').transaction(v => v - cost);
        const res = document.getElementById('boxRes');
        res.innerText = "ROLLING...";
        res.style.color = "#fff";
        
        setTimeout(() => {
            let win = Math.floor(Math.random() * (max - min + 1)) + min;
            db.ref('users/'+user).transaction(u => {
                if(u) { u.balance += win; u.xp += 150; }
                return u;
            });
            res.innerText = win.toLocaleString() + " ‚ÇΩ";
            res.style.color = (win >= cost) ? 'var(--green)' : 'var(--pink)';
            sfx(win >= cost ? 1200 : 300);
            isCaseOpening = false;
            btn.classList.remove('btn-disabled');
        }, 2000);
    }

    // --- UTILS ---
    function clickFarm() {
        sfx(400, 'sine', 0.1);
        db.ref('users/'+user).transaction(u => {
            if(u) {
                u.balance += (u.lvl * 5);
                u.xp += 20;
                if(u.xp >= u.lvl * 1500) {
                    u.lvl++; u.xp = 0;
                    toast("–£–†–û–í–ï–ù–¨ –ü–û–í–´–®–ï–ù!");
                    sfx(1500, 'sine', 0.5);
                }
            }
            return u;
        });
    }

    function sendMsg() {
        const input = document.getElementById('chatInput');
        let text = input.value.trim();
        if(text && user) {
            db.ref('chat').push().set({
                u: user,
                t: ": " + text
            });
            input.value = '';
        }
    }

    function syncLeaderboard() {
        db.ref('users').once('value', snap => {
            const list = document.getElementById('listTop');
            list.innerHTML = '';
            let leaders = [];
            snap.forEach(u => { leaders.push({name: u.key, bal: u.val().balance}); });
            leaders.sort((a,b) => b.bal - a.bal).slice(0, 10).forEach((l, i) => {
                list.innerHTML += `
                    <div class="leader-item">
                        <span><b>#${i+1}</b> ${l.name.toUpperCase()}</span>
                        <span style="color:var(--green); font-family:'Orbitron';">${Math.floor(l.bal).toLocaleString()} ‚ÇΩ</span>
                    </div>`;
            });
        });
        setTimeout(syncLeaderboard, 30000);
    }

    function showTab(btn, tabId) {
        document.querySelectorAll('.nav-btn, .viewport').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(tabId).classList.add('active');
        if(tabId === 'viewMining') renderShop();
    }

    function renderShop() {
        const cont = document.getElementById('listGPU');
        cont.innerHTML = '';
        GPUS.forEach(g => {
            let count = (userData.gpus && userData.gpus[g.id]) || 0;
            cont.innerHTML += `
                <div class="glass-panel" style="flex-direction:row; padding:25px; align-items:center; justify-content:space-between; background:rgba(255,255,255,0.01);">
                    <div>
                        <b style="color:var(--accent); font-size:18px;">${g.n}</b><br>
                        <small style="color:#5d727b;">–î–û–•–û–î: +${g.i} ‚ÇΩ/—Å–µ–∫ | –í –ù–ê–õ–ò–ß–ò–ò: ${count}</small>
                    </div>
                    <button class="btn-ui btn-accent" style="padding:15px 25px; font-size:12px;" onclick="buyGPU('${g.id}', ${g.p})">
                        –ö–£–ü–ò–¢–¨ –ó–ê ${g.p.toLocaleString()} ‚ÇΩ
                    </button>
                </div>`;
        });
    }

    function buyGPU(id, price) {
        if(userData.balance >= price) {
            db.ref('users/'+user).transaction(u => {
                if(u) {
                    u.balance -= price;
                    if(!u.gpus) u.gpus = {};
                    u.gpus[id] = (u.gpus[id] || 0) + 1;
                }
                return u;
            });
            toast("–û–ë–û–†–£–î–û–í–ê–ù–ò–ï –ö–£–ü–õ–ï–ù–û!");
            sfx(1100);
            renderShop();
        } else toast("–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–†–ï–î–°–¢–í!");
    }

    window.onresize = () => { bgCvs.width = window.innerWidth; bgCvs.height = window.innerHeight; };
</script>
</body>
</html>
