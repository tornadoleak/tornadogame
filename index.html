<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>TORNADO GAME ENGINE V10</title>
    <style>
        :root {
            --bg: #0f1117;
            --panel: #161922;
            --accent: #3b82f6;
            --green: #10b981;
            --red: #ef4444;
            --text: #f8fafc;
            --border: #2d3343;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { background: var(--bg); color: var(--text); overflow-x: hidden; }

        /* HEADER */
        header {
            height: 70px; background: var(--panel); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 30px;
            position: sticky; top: 0; z-index: 100;
        }
        .logo { font-size: 24px; font-weight: 800; color: var(--accent); letter-spacing: 1px; }
        .user-info { display: flex; gap: 25px; align-items: center; }
        .balance-display { background: #1e2330; padding: 8px 15px; border-radius: 8px; border: 1px solid var(--border); }
        .balance-display span { color: var(--green); font-weight: bold; }

        /* MAIN LAYOUT */
        .wrapper { display: grid; grid-template-columns: 260px 1fr 320px; min-height: calc(100vh - 70px); }

        /* SIDEBAR */
        nav { background: var(--panel); border-right: 1px solid var(--border); padding: 20px; }
        .menu-item {
            padding: 14px 18px; border-radius: 10px; cursor: pointer; margin-bottom: 8px;
            transition: 0.2s; color: #94a3b8; font-weight: 600;
        }
        .menu-item:hover { background: #1e2330; color: #fff; }
        .menu-item.active { background: var(--accent); color: #fff; }

        /* GAME AREA */
        main { padding: 30px; }
        .game-card { background: var(--panel); border-radius: 15px; border: 1px solid var(--border); padding: 25px; display: none; }
        .game-card.active { display: block; }

        /* CRASH */
        .crash-canvas-container { position: relative; background: #0b0e14; border-radius: 10px; height: 400px; margin-bottom: 20px; overflow: hidden; }
        #crash-canvas { width: 100%; height: 100%; }
        .crash-mult { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            font-size: 70px; font-weight: 800; text-shadow: 0 0 20px rgba(255,255,255,0.2);
        }

        /* MINES */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 450px; margin: 20px auto; }
        .mine-tile { 
            aspect-ratio: 1; background: #2d3343; border-radius: 8px; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; font-size: 24px; transition: 0.2s;
        }
        .mine-tile:hover { background: #3e465b; }
        .mine-tile.gem { background: var(--green); box-shadow: 0 0 15px var(--green); }
        .mine-tile.bomb { background: var(--red); box-shadow: 0 0 15px var(--red); }

        /* LADDER */
        .ladder-container { display: flex; flex-direction: column-reverse; gap: 5px; max-width: 400px; margin: 0 auto; }
        .ladder-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; opacity: 0.5; }
        .ladder-row.active { opacity: 1; }
        .ladder-step { height: 40px; background: #2d3343; border-radius: 4px; cursor: pointer; text-align: center; line-height: 40px; }
        .ladder-step.win { background: var(--green); }
        .ladder-step.lose { background: var(--red); }

        /* CONTROLS */
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .input-box { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; color: #64748b; font-weight: bold; text-transform: uppercase; }
        input, select { 
            background: #0f1117; border: 1px solid var(--border); padding: 12px; 
            color: #fff; border-radius: 8px; font-size: 16px;
        }
        .btn { 
            background: var(--accent); color: white; border: none; padding: 15px; 
            border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s; 
            grid-column: span 2; font-size: 16px;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn:disabled { background: #334155; cursor: not-allowed; transform: none; }

        /* CHAT & STATS */
        .sidebar-right { background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        .tabs { display: flex; border-bottom: 1px solid var(--border); }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-size: 13px; font-weight: 600; color: #64748b; }
        .tab.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        .content-area { flex: 1; overflow-y: auto; padding: 15px; }
        .chat-msg { margin-bottom: 10px; font-size: 13px; background: #1e2330; padding: 10px; border-radius: 8px; }
        .chat-msg b { color: var(--accent); }
        .chat-input { padding: 15px; border-top: 1px solid var(--border); display: flex; gap: 5px; }

        /* MINING VIEW */
        .mining-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .gpu-card { background: #1e2330; padding: 15px; border-radius: 12px; border: 1px solid var(--border); }
        .gpu-card h4 { color: var(--accent); margin-bottom: 5px; }
        .gpu-card p { font-size: 12px; color: #94a3b8; }

        /* NOTIFICATION */
        #notif { 
            position: fixed; bottom: 20px; left: 20px; padding: 15px 25px; 
            border-radius: 8px; background: var(--panel); border-left: 4px solid var(--accent);
            transform: translateX(-150%); transition: 0.3s; z-index: 1000;
        }

        /* CASES */
        .case-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .case-item { background: #1e2330; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid var(--border); cursor: pointer; }
        .case-item:hover { border-color: var(--accent); }
    </style>
</head>
<body>

<div id="notif">–°–æ–æ–±—â–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</div>

<header>
    <div class="logo">TORNADO SYSTEM</div>
    <div class="user-info">
        <div class="balance-display">–ë–∞–ª–∞–Ω—Å: <span id="balance-val">0</span> ‚ÇΩ</div>
        <div id="user-name" style="font-weight: bold;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
</header>

<div class="wrapper">
    <nav>
        <div class="menu-item active" onclick="showGame('crash', this)">üìà Crash</div>
        <div class="menu-item" onclick="showGame('mines', this)">üí£ Mines</div>
        <div class="menu-item" onclick="showGame('ladder', this)">ü™ú Ladder</div>
        <div class="menu-item" onclick="showGame('cases', this)">üì¶ Cases</div>
        <div class="menu-item" onclick="showGame('mining', this)">‚ö° Mining</div>
        <div class="menu-item" onclick="showGame('wheel', this)">üé° Wheel</div>
        <div class="menu-item" onclick="showGame('tasks', this)">üìÖ Tasks</div>
        <div class="menu-item" onclick="showGame('settings', this)">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        <div style="margin-top: 40px; padding: 15px; background: #1e2330; border-radius: 10px;">
            <small style="color: #64748b;">–í–∞—à —É—Ä–æ–≤–µ–Ω—å:</small>
            <div id="user-lvl" style="font-size: 20px; font-weight: bold; color: var(--accent);">LVL 1</div>
        </div>
    </nav>

    <main>
        <div id="game-crash" class="game-card active">
            <div class="crash-canvas-container">
                <canvas id="crash-canvas"></canvas>
                <div class="crash-mult" id="crash-val">1.00x</div>
            </div>
            <div class="controls">
                <div class="input-box">
                    <label>–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏</label>
                    <input type="number" id="crash-bet" value="100">
                </div>
                <div class="input-box">
                    <label>–ê–≤—Ç–æ-–≤—ã–≤–æ–¥</label>
                    <input type="number" id="crash-auto" value="2.0">
                </div>
                <button class="btn" id="crash-btn" onclick="crashAction()">–ü–û–°–¢–ê–í–ò–¢–¨</button>
            </div>
        </div>

        <div id="game-mines" class="game-card">
            <div class="mines-grid" id="mines-board"></div>
            <div class="controls">
                <div class="input-box">
                    <label>–°—Ç–∞–≤–∫–∞</label>
                    <input type="number" id="mines-bet" value="100">
                </div>
                <div class="input-box">
                    <label>–ö–æ–ª-–≤–æ –ª–æ–≤—É—à–µ–∫</label>
                    <select id="mines-count">
                        <option value="1">1 –ª–æ–≤—É—à–∫–∞</option>
                        <option value="3" selected>3 –ª–æ–≤—É—à–∫–∏</option>
                        <option value="5">5 –ª–æ–≤—É—à–µ–∫</option>
                        <option value="10">10 –ª–æ–≤—É—à–µ–∫</option>
                        <option value="24">24 –ª–æ–≤—É—à–∫–∏</option>
                    </select>
                </div>
                <button class="btn" id="mines-btn" onclick="minesAction()">–ò–ì–†–ê–¢–¨</button>
            </div>
        </div>

        <div id="game-ladder" class="game-card">
            <div class="ladder-container" id="ladder-board"></div>
            <div class="controls">
                <div class="input-box">
                    <label>–°—Ç–∞–≤–∫–∞</label>
                    <input type="number" id="ladder-bet" value="100">
                </div>
                <button class="btn" id="ladder-btn" onclick="ladderAction()">–ù–ê–ß–ê–¢–¨ –í–û–°–•–û–ñ–î–ï–ù–ò–ï</button>
            </div>
        </div>

        <div id="game-mining" class="game-card">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 id="mining-speed">0.00 ‚ÇΩ/—Å–µ–∫</h2>
                <p style="color: #64748b;">–í–∞—à–∞ —Ç–µ–∫—É—â–∞—è –º–æ—â–Ω–æ—Å—Ç—å</p>
            </div>
            <div class="mining-grid" id="mining-shop"></div>
        </div>

        <div id="game-cases" class="game-card">
            <div class="case-grid" id="case-list"></div>
        </div>

        <div id="game-wheel" class="game-card">
            <div style="width: 300px; height: 300px; border-radius: 50%; border: 5px solid var(--accent); margin: 0 auto; display: flex; align-items: center; justify-content: center; position: relative;">
                <div id="wheel-arrow" style="position: absolute; top: -10px; width: 20px; height: 20px; background: red; clip-path: polygon(50% 100%, 0 0, 100% 0);"></div>
                <div id="wheel-body" style="width: 100%; height: 100%; border-radius: 50%; transition: 3s cubic-bezier(0.1, 0, 0.1, 1); background: conic-gradient(var(--red) 0% 25%, var(--accent) 25% 50%, var(--green) 50% 75%, var(--border) 75% 100%);"></div>
            </div>
            <div class="controls" style="margin-top: 40px;">
                <div class="input-box"><label>–°—Ç–∞–≤–∫–∞</label><input type="number" id="wheel-bet" value="100"></div>
                <div class="input-box">
                    <label>–¶–≤–µ—Ç</label>
                    <select id="wheel-color">
                        <option value="red">–ö—Ä–∞—Å–Ω—ã–π (x2)</option>
                        <option value="blue">–°–∏–Ω–∏–π (x2)</option>
                        <option value="green">–ó–µ–ª–µ–Ω—ã–π (x4)</option>
                    </select>
                </div>
                <button class="btn" onclick="spinWheel()">–ö–†–£–¢–ò–¢–¨</button>
            </div>
        </div>
    </main>

    <div class="sidebar-right">
        <div class="tabs">
            <div class="tab active" onclick="switchRightTab('chat')">–ß–ê–¢</div>
            <div class="tab" onclick="switchRightTab('stats')">–¢–û–ü</div>
        </div>
        <div class="content-area" id="right-content">
            </div>
        <div class="chat-input" id="chat-input-container">
            <input type="text" id="msg-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
            <button class="btn" style="padding: 10px; width: auto;" onclick="sendMessage()">‚û§</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
// --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
const firebaseConfig = {
    apiKey: "AIzaSyC8UkaoaI7nHRSxNPddRwXnNxzHX7kt8s8",
    databaseURL: "https://tornadogame-41ae2-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "tornadogame-41ae2",
    appId: "1:926174944730:web:20be5b57efb23ab853b4e3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// --- –°–û–°–¢–û–Ø–ù–ò–ï ---
let user = {
    id: 'user_' + Math.floor(Math.random() * 9999),
    balance: 5000,
    lvl: 1,
    exp: 0,
    miningPower: 0,
    inventory: []
};

let currentCrash = { active: false, mult: 1.0, bet: 0, cashed: false };
let currentMines = { active: false, bet: 0, count: 3, board: [] };
let currentLadder = { active: false, bet: 0, step: 0 };

// --- –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô ---
function notify(text, color = '#3b82f6') {
    const n = document.getElementById('notif');
    n.innerText = text;
    n.style.borderColor = color;
    n.style.transform = 'translateX(0)';
    setTimeout(() => n.style.transform = 'translateX(-150%)', 3000);
}

// --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ---
function initUser() {
    const saved = localStorage.getItem('tornado_user');
    if(saved) {
        const parsed = JSON.parse(saved);
        user.id = parsed.id;
    } else {
        localStorage.setItem('tornado_user', JSON.stringify({id: user.id}));
    }

    db.ref('users/' + user.id).on('value', snap => {
        if(snap.exists()) {
            user = snap.val();
        } else {
            db.ref('users/' + user.id).set(user);
        }
        updateUI();
    });
}

function updateUI() {
    document.getElementById('balance-val').innerText = Math.floor(user.balance).toLocaleString();
    document.getElementById('user-name').innerText = user.id;
    document.getElementById('user-lvl').innerText = 'LVL ' + user.lvl;
}

function updateBalance(amt) {
    db.ref('users/' + user.id + '/balance').transaction(b => (b || 0) + amt);
}

// --- CRASH –õ–û–ì–ò–ö–ê ---
const canvas = document.getElementById('crash-canvas');
const ctx = canvas.getContext('2d');
canvas.width = 800; canvas.height = 400;

function drawCrash(m) {
    ctx.clearRect(0,0,800,400);
    ctx.strokeStyle = '#3b82f6';
    ctx.lineWidth = 5;
    ctx.beginPath();
    ctx.moveTo(0, 400);
    for(let x=0; x<m*100; x++) {
        let y = 400 - (Math.pow(1.006, x) * 10);
        ctx.lineTo(x * (800/(m*100)), y);
    }
    ctx.stroke();
}

function crashAction() {
    if(!currentCrash.active) {
        let bet = parseInt(document.getElementById('crash-bet').value);
        if(bet > user.balance) return notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', 'red');
        
        updateBalance(-bet);
        currentCrash = { active: true, mult: 1.0, bet: bet, cashed: false };
        document.getElementById('crash-btn').innerText = '–í–´–í–ï–°–¢–ò';
        
        let crashPoint = Math.random() * 5 + 1.01;
        let loop = setInterval(() => {
            currentCrash.mult += 0.01;
            document.getElementById('crash-val').innerText = currentCrash.mult.toFixed(2) + 'x';
            drawCrash(currentCrash.mult);

            // Auto cashout
            let auto = parseFloat(document.getElementById('crash-auto').value);
            if(!currentCrash.cashed && currentCrash.mult >= auto) crashAction();

            if(currentCrash.mult >= crashPoint) {
                clearInterval(loop);
                if(!currentCrash.cashed) {
                    notify('Crash! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏', 'red');
                }
                resetCrash();
            }
        }, 50);
    } else {
        if(!currentCrash.cashed) {
            let win = currentCrash.bet * currentCrash.mult;
            updateBalance(win);
            currentCrash.cashed = true;
            notify(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${Math.floor(win)} ‚ÇΩ!`, 'green');
            document.getElementById('crash-btn').disabled = true;
        }
    }
}

function resetCrash() {
    currentCrash.active = false;
    document.getElementById('crash-btn').disabled = false;
    document.getElementById('crash-btn').innerText = '–ü–û–°–¢–ê–í–ò–¢–¨';
    setTimeout(() => {
        ctx.clearRect(0,0,800,400);
        document.getElementById('crash-val').innerText = '1.00x';
    }, 2000);
}

// --- MINES –õ–û–ì–ò–ö–ê ---
function minesAction() {
    if(currentMines.active) {
        // Cashout
        let mult = calculateMinesMult();
        let win = currentMines.bet * mult;
        updateBalance(win);
        notify(`–ó–∞–±—Ä–∞–ª–∏ ${Math.floor(win)} ‚ÇΩ`, 'green');
        endMines();
        return;
    }

    let bet = parseInt(document.getElementById('mines-bet').value);
    let count = parseInt(document.getElementById('mines-count').value);
    if(bet > user.balance) return notify('–ú–∞–ª–æ –¥–µ–Ω–µ–≥', 'red');

    updateBalance(-bet);
    currentMines = { active: true, bet: bet, count: count, board: [], revealed: 0 };
    
    // –ì–µ–Ω–µ—Ä–∏–º –±–æ–º–±—ã
    let bombs = [];
    while(bombs.length < count) {
        let r = Math.floor(Math.random() * 25);
        if(!bombs.includes(r)) bombs.push(r);
    }
    currentMines.bombs = bombs;

    const board = document.getElementById('mines-board');
    board.innerHTML = '';
    for(let i=0; i<25; i++) {
        let t = document.createElement('div');
        t.className = 'mine-tile';
        t.onclick = () => clickMine(i, t);
        board.appendChild(t);
    }
    document.getElementById('mines-btn').innerText = '–ó–ê–ë–†–ê–¢–¨';
}

function clickMine(idx, el) {
    if(!currentMines.active || el.classList.contains('gem')) return;

    if(currentMines.bombs.includes(idx)) {
        el.classList.add('bomb');
        el.innerText = 'üí£';
        notify('–ë–û–ú–ë–ê! –°—Ç–∞–≤–∫–∞ —Å–≥–æ—Ä–µ–ª–∞', 'red');
        endMines();
    } else {
        el.classList.add('gem');
        el.innerText = 'üíé';
        currentMines.revealed++;
        let mult = calculateMinesMult();
        document.getElementById('mines-btn').innerText = `–ó–ê–ë–†–ê–¢–¨ (${mult}x)`;
    }
}

function calculateMinesMult() {
    let n = 25, m = currentMines.count, r = currentMines.revealed;
    if(r === 0) return 1.0;
    let mult = 1;
    for(let i=0; i<r; i++) mult *= (n-i)/(n-m-i);
    return (mult * 0.95).toFixed(2);
}

function endMines() {
    currentMines.active = false;
    document.getElementById('mines-btn').innerText = '–ò–ì–†–ê–¢–¨';
}

// --- MINING –°–ò–°–¢–ï–ú–ê ---
const SHOP = [
    { name: 'Core i3 Engine', price: 1000, power: 0.5 },
    { name: 'GTX 1660 Ti', price: 5000, power: 3.2 },
    { name: 'RTX 4090 Monster', price: 50000, power: 45 },
    { name: 'Server Rack', price: 250000, power: 300 }
];

function initMining() {
    const container = document.getElementById('mining-shop');
    SHOP.forEach(item => {
        let div = document.createElement('div');
        div.className = 'gpu-card';
        div.innerHTML = `
            <h4>${item.name}</h4>
            <p>–î–æ—Ö–æ–¥: ${item.power} ‚ÇΩ/—Å–µ–∫</p>
            <button class="btn" style="margin-top:10px; padding:5px;" onclick="buyGpu(${item.price}, ${item.power})">–ö—É–ø–∏—Ç—å –∑–∞ ${item.price}</button>
        `;
        container.appendChild(div);
    });

    setInterval(() => {
        if(user.miningPower > 0) {
            updateBalance(user.miningPower / 10);
            document.getElementById('mining-speed').innerText = user.miningPower.toFixed(2) + ' ‚ÇΩ/—Å–µ–∫';
        }
    }, 100);
}

function buyGpu(p, pw) {
    if(user.balance >= p) {
        updateBalance(-p);
        db.ref('users/' + user.id).transaction(u => {
            if(u) u.miningPower = (u.miningPower || 0) + pw;
            return u;
        });
        notify('–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ!');
    }
}

// --- –ß–ê–¢ ---
function sendMessage() {
    let inp = document.getElementById('msg-input');
    if(!inp.value) return;
    db.ref('chat').push({
        user: user.id,
        text: inp.value,
        time: Date.now()
    });
    inp.value = '';
}

db.ref('chat').limitToLast(20).on('value', snap => {
    let area = document.getElementById('right-content');
    if(document.querySelector('.tab.active').innerText !== '–ß–ê–¢') return;
    area.innerHTML = '';
    snap.forEach(m => {
        let d = document.createElement('div');
        d.className = 'chat-msg';
        d.innerHTML = `<b>${m.val().user}:</b> ${m.val().text}`;
        area.appendChild(d);
    });
    area.scrollTop = area.scrollHeight;
});

// --- –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –ò–ì–† ---
function showGame(id, el) {
    document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
    document.querySelectorAll('.game-card').forEach(g => g.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('game-' + id).classList.add('active');
}

function switchRightTab(type) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    // –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–ß–∞—Ç/–¢–æ–ø)
}

// –ó–∞–ø—É—Å–∫
initUser();
initMining();

</script>
</body>
</html>
