<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TORNADO V8.5 | STABLE TITAN</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff; --pink: #ff007b; --gold: #ffcc00; --green: #00ff88;
            --bg: #05080a; --card: rgba(13, 19, 23, 0.98); --border: rgba(0, 242, 255, 0.2);
        }

        * { box-sizing: border-box; transition: all 0.2s ease-out; outline: none; }
        body {
            font-family: 'Inter', sans-serif; background: var(--bg); color: #fff;
            margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center;
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, #0a131a 0%, #05080a 100%);
        }

        .main-grid { display: grid; grid-template-columns: 1fr 380px; gap: 20px; width: 98vw; height: 96vh; max-width: 1700px; }
        .panel { background: var(--card); border: 1px solid var(--border); border-radius: 32px; display: flex; flex-direction: column; overflow: hidden; backdrop-filter: blur(20px); box-shadow: 0 20px 60px rgba(0,0,0,0.8); }

        /* Auth Screen */
        #authBox { width: 450px; padding: 50px; text-align: center; box-shadow: 0 0 100px rgba(0, 242, 255, 0.1); }
        .auth-tabs { display: flex; gap: 10px; margin-bottom: 25px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 15px; }
        .auth-tab { flex: 1; padding: 10px; border-radius: 12px; cursor: pointer; font-size: 11px; font-weight: 800; color: #5d727b; text-transform: uppercase; }
        .auth-tab.active { background: var(--accent); color: #000; }

        /* Nav */
        .navbar { display: flex; background: rgba(0,0,0,0.4); padding: 12px; gap: 8px; border-bottom: 1px solid var(--border); overflow-x: auto; scrollbar-width: none; }
        .nav-link { padding: 12px 20px; border-radius: 16px; cursor: pointer; font-size: 11px; font-weight: 800; text-transform: uppercase; color: #5d727b; white-space: nowrap; }
        .nav-link.active { background: rgba(0, 242, 255, 0.1); color: var(--accent); box-shadow: 0 0 20px rgba(0, 242, 255, 0.1); }

        .content { flex: 1; overflow-y: auto; padding: 25px; display: none; flex-direction: column; gap: 20px; }
        .content.active { display: flex; animation: viewIn 0.4s forwards; }
        @keyframes viewIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Crash */
        .crash-area { height: 350px; background: #080c10; border-radius: 24px; position: relative; overflow: hidden; border: 1px solid var(--border); }
        #crashCanvas { width: 100%; height: 100%; }
        .crash-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; z-index: 5; }
        #crashVal { font-family: 'Orbitron'; font-size: 5.5rem; font-weight: 900; text-shadow: 0 0 40px var(--accent); margin: 0; }
        #crashProfit { color: var(--green); font-size: 1.5rem; font-weight: 800; font-family: 'Orbitron'; height: 35px; }

        /* Buttons & Inputs */
        .btn { border: none; padding: 18px; border-radius: 20px; font-weight: 900; cursor: pointer; text-transform: uppercase; font-family: 'Orbitron'; font-size: 13px; }
        .btn-main { background: linear-gradient(135deg, var(--accent), #0072ff); color: #000; box-shadow: 0 5px 20px rgba(0, 242, 255, 0.3); }
        .btn-green { background: linear-gradient(135deg, var(--green), #00b35d); color: #000; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: #fff; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        input { background: rgba(0,0,0,0.5); border: 1px solid var(--border); padding: 18px; border-radius: 20px; color: #fff; font-family: 'Orbitron'; font-size: 16px; width: 100%; }

        /* Games Grid */
        .grid-5x5 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; max-width: 450px; margin: 0 auto; }
        .cell { aspect-ratio: 1; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .cell.active { background: var(--accent); box-shadow: 0 0 25px var(--accent); color: #000; }
        .cell.death { background: var(--pink); box-shadow: 0 0 25px var(--pink); }

        /* Sidebar */
        .user-info { padding: 30px; text-align: center; border-bottom: 1px solid var(--border); }
        .balance-text { font-family: 'Orbitron'; font-size: 2.5rem; font-weight: 900; color: var(--accent); text-shadow: 0 0 20px rgba(0, 242, 255, 0.2); }
        .xp-bar { height: 10px; background: rgba(255,255,255,0.05); border-radius: 20px; overflow: hidden; margin: 10px 0; }
        .xp-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--pink)); transition: width 0.5s ease; }

        /* Chat */
        #chatBox { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .chat-msg { background: rgba(255,255,255,0.03); padding: 12px 16px; border-radius: 18px; font-size: 13px; border-left: 3px solid var(--accent); }
        .chat-msg b { color: var(--accent); font-family: 'Orbitron'; font-size: 10px; display: block; margin-bottom: 4px; }

        /* Notifications */
        #notif { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: var(--card); border: 1px solid var(--border); padding: 15px 25px; border-radius: 15px; animation: slideIn 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        #lvlPopup { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:10001; display:none; flex-direction:column; align-items:center; justify-content:center; }
    </style>
</head>
<body>

<div id="notif"></div>
<div id="lvlPopup"><div style="font-family:'Orbitron'; font-size:8rem; color:var(--accent);" id="lvlNum">2</div><p>–ù–û–í–´–ô –£–†–û–í–ï–ù–¨ –î–û–°–¢–ò–ì–ù–£–¢</p></div>

<div id="authBox" class="panel">
    <h1 style="font-family:'Orbitron'; margin:0; color:var(--accent);">TORNADO</h1>
    <p style="letter-spacing: 5px; font-size: 10px; color: #5d727b; margin-bottom: 30px;">V8.5 STABLE</p>
    
    <div class="auth-tabs">
        <div class="auth-tab active" id="tabL" onclick="setAuthMode('login')">–í—Ö–æ–¥</div>
        <div class="auth-tab" id="tabR" onclick="setAuthMode('reg')">–°–æ–∑–¥–∞—Ç—å</div>
    </div>
    
    <input type="text" id="loginU" placeholder="–õ–û–ì–ò–ù" style="margin-bottom: 15px;">
    <input type="password" id="loginP" placeholder="–ü–ê–†–û–õ–¨" style="margin-bottom: 25px;">
    <button class="btn btn-main" style="width: 100%;" id="authBtn" onclick="handleAuth()">–í–û–ô–¢–ò –í –°–ò–°–¢–ï–ú–£</button>
</div>

<div class="main-grid" id="gameApp" style="display: none;">
    <div class="panel">
        <div class="navbar">
            <div class="nav-link active" onclick="showTab(this, 'tabCrash')">CRASH</div>
            <div class="nav-link" onclick="showTab(this, 'tabMines')">MINES</div>
            <div class="nav-link" onclick="showTab(this, 'tabLadder')">LADDER</div>
            <div class="nav-link" onclick="showTab(this, 'tabMining')">MINING</div>
            <div class="nav-link" onclick="showTab(this, 'tabCases')">CASES</div>
            <div class="nav-link" onclick="showTab(this, 'tabTop')">LEADERS</div>
        </div>

        <div id="tabCrash" class="content active">
            <div class="crash-area">
                <canvas id="crashCanvas"></canvas>
                <div class="crash-overlay">
                    <p id="crashVal">1.00x</p>
                    <div id="crashProfit"></div>
                </div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <input type="number" id="crashBet" placeholder="–°–¢–ê–í–ö–ê">
                <input type="number" id="crashAuto" placeholder="–ê–í–¢–û (1.50)">
            </div>
            <button id="crashBtn" class="btn btn-main" style="font-size:20px;" onclick="doCrashAction()">–ü–û–°–¢–ê–í–ò–¢–¨</button>
        </div>

        <div id="tabMines" class="content">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <input type="number" id="minesBet" placeholder="–°–¢–ê–í–ö–ê">
                <select id="minesCount" style="background:#000; color:#fff; border:1px solid var(--border); border-radius:20px; padding:0 20px;">
                    <option value="3">3 –ú–ò–ù–´</option><option value="10">10 –ú–ò–ù</option><option value="24">24 –ú–ò–ù–´</option>
                </select>
            </div>
            <div id="minesGrid" class="grid-5x5"></div>
            <button id="minesAction" class="btn btn-main" onclick="startMines()">–ò–ì–†–ê–¢–¨</button>
        </div>

        <div id="tabLadder" class="content">
            <input type="number" id="ladderBet" placeholder="–°–¢–ê–í–ö–ê" style="margin-bottom:20px;">
            <div id="ladderGame" style="display:flex; flex-direction:column-reverse; gap:10px; align-items:center;"></div>
            <button id="ladderBtn" class="btn btn-main" style="margin-top:20px;" onclick="startLadder()">–°–¢–ê–†–¢</button>
        </div>

        <div id="tabMining" class="content">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <button class="btn btn-main" style="height:120px;" onclick="manualClick()">
                    –ö–õ–ò–ö–ê–¢–¨<br><span id="clickVal" style="font-size:10px;">+2‚ÇΩ</span>
                </button>
                <div class="panel" style="justify-content:center; align-items:center; background:rgba(0,0,0,0.3);">
                    <p style="font-size:10px; color:#5d727b; margin:0;">–î–û–•–û–î –í –°–ï–ö–£–ù–î–£</p>
                    <h2 id="passiveVal" style="color:var(--green); margin:0;">0 ‚ÇΩ</h2>
                </div>
            </div>
            <div id="gpuList" style="display:grid; gap:10px; margin-top:20px;"></div>
        </div>

        <div id="tabCases" class="content">
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px;">
                <div class="panel" style="padding:20px; text-align:center;">
                    <h3>–ë–û–ú–ñ</h3><p>1,000 ‚ÇΩ</p>
                    <button class="btn btn-outline" onclick="openCase(1000, 3000)">–û–¢–ö–†–´–¢–¨</button>
                </div>
                <div class="panel" style="padding:20px; text-align:center; border-color:var(--gold);">
                    <h3 style="color:var(--gold);">–ú–ê–ñ–û–†</h3><p>50,000 ‚ÇΩ</p>
                    <button class="btn btn-main" onclick="openCase(50000, 250000)">–û–¢–ö–†–´–¢–¨</button>
                </div>
            </div>
            <h1 id="caseRes" style="text-align:center; font-family:'Orbitron'; margin-top:40px;"></h1>
        </div>

        <div id="tabTop" class="content">
            <h2 style="font-family:'Orbitron'; text-align:center;">–¢–û–ü 10 –ò–ì–†–û–ö–û–í</h2>
            <div id="topList" style="display:flex; flex-direction:column; gap:8px;"></div>
        </div>
    </div>

    <div class="panel">
        <div class="user-info">
            <div class="balance-text" id="uBal">0 ‚ÇΩ</div>
            <div class="xp-bar"><div class="xp-fill" id="uFill"></div></div>
            <div style="display:flex; justify-content:space-between; font-size:10px; font-weight:800; color:#5d727b;">
                <span id="uLvl">LVL 1</span><span id="uXp">0 / 1000</span>
            </div>
        </div>
        <div id="chatBox"></div>
        <div style="padding:20px; display:flex; gap:10px; background:rgba(0,0,0,0.2);">
            <input type="text" id="chatIn" placeholder="–ß–∞—Ç..." style="font-size:14px; padding:12px;">
            <button class="btn btn-main" onclick="sendChat()">></button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
    // --- DATABASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyC8UkaoaI7nHRSxNPddRwXnNxzHX7kt8s8",
        authDomain: "tornadogame-41ae2.firebaseapp.com",
        databaseURL: "https://tornadogame-41ae2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "tornadogame-41ae2",
        appId: "1:926174944730:web:20be5b57efb23ab853b4e3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- STATE ---
    let user = null, userData = {}, authMode = 'login', audio;
    let crash = { active: false, mult: 1.0, bet: 0, cashed: false, pts: [] };
    let mines = { active: false, bet: 0, bombs: [], open: 0, total: 3 };
    let ladder = { active: false, bet: 0, step: 0 };

    const GPUS = [
        {id:'g1', n:'GTX 1660', p:25000, i:20},
        {id:'g2', n:'RTX 4090', p:600000, i:550},
        {id:'g3', n:'ANTMINER V8', p:2000000, i:2200}
    ];

    // --- UTILS ---
    function sfx(f, t='sine', d=0.1, v=0.07) {
        if(!audio) audio = new (window.AudioContext || window.webkitAudioContext)();
        const o = audio.createOscillator(); const g = audio.createGain();
        o.type = t; o.frequency.setValueAtTime(f, audio.currentTime);
        g.gain.setValueAtTime(v, audio.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, audio.currentTime + d);
        o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime + d);
    }

    function toast(txt) {
        const b = document.getElementById('notif');
        const t = document.createElement('div'); t.className = 'toast'; t.innerText = txt;
        b.appendChild(t); setTimeout(() => t.remove(), 3000);
    }

    // --- AUTH LOGIC ---
    function setAuthMode(m) {
        authMode = m;
        document.getElementById('tabL').classList.toggle('active', m==='login');
        document.getElementById('tabR').classList.toggle('active', m==='reg');
        document.getElementById('authBtn').innerText = m==='login' ? '–í–û–ô–¢–ò –í –°–ò–°–¢–ï–ú–£' : '–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø';
    }

    function handleAuth() {
        const u = document.getElementById('loginU').value.trim().toLowerCase();
        const p = document.getElementById('loginP').value.trim();
        if(u.length < 3 || p.length < 3) return toast("–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞!");

        db.ref('users/' + u).once('value', s => {
            if(authMode === 'login') {
                if(s.exists() && s.val().pass === p) run(u, s.val());
                else toast("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞!");
            } else {
                if(s.exists()) toast("–õ–æ–≥–∏–Ω –∑–∞–Ω—è—Ç!");
                else {
                    const d = { pass: p, balance: 10000, xp: 0, lvl: 1, gpus: {} };
                    db.ref('users/' + u).set(d).then(() => run(u, d));
                }
            }
        });
    }

    function run(id, data) {
        user = id;
        document.getElementById('authBox').style.display = 'none';
        document.getElementById('gameApp').style.display = 'grid';
        
        db.ref('users/' + user).on('value', s => {
            userData = s.val();
            updateUI();
        });

        db.ref('chat').limitToLast(25).on('value', s => {
            const b = document.getElementById('chatBox'); b.innerHTML = '';
            s.forEach(m => {
                b.innerHTML += `<div class="chat-msg"><b>${m.val().u}</b>${m.val().t}</div>`;
            });
            b.scrollTop = b.scrollHeight;
        });

        initCrash();
        renderGpus();
        updateTop();
        
        setInterval(() => {
            let inc = 0;
            if(userData.gpus) GPUS.forEach(g => inc += (userData.gpus[g.id] || 0) * g.i);
            if(inc > 0) db.ref('users/'+user+'/balance').transaction(b => b + inc);
        }, 1000);
        toast("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, " + id);
    }

    function updateUI() {
        document.getElementById('uBal').innerText = Math.floor(userData.balance).toLocaleString() + ' ‚ÇΩ';
        const next = userData.lvl * 1000;
        document.getElementById('uFill').style.width = (userData.xp / next * 100) + '%';
        document.getElementById('uLvl').innerText = 'LVL ' + userData.lvl;
        document.getElementById('uXp').innerText = `${userData.xp} / ${next}`;
        document.getElementById('clickVal').innerText = `+${userData.lvl * 2.5}‚ÇΩ`;
        
        let pass = 0; if(userData.gpus) GPUS.forEach(g => pass += (userData.gpus[g.id]||0)*g.i);
        document.getElementById('passiveVal').innerText = pass + ' ‚ÇΩ/—Å';
    }

    // --- CRASH ---
    const cvs = document.getElementById('crashCanvas');
    const ctx = cvs.getContext('2d');

    function initCrash() {
        crash.active = false; crash.mult = 1.0; crash.cashed = false; crash.pts = [];
        const btn = document.getElementById('crashBtn');
        btn.innerText = "–ü–û–°–¢–ê–í–ò–¢–¨"; btn.disabled = false; btn.className = 'btn btn-main';
        document.getElementById('crashProfit').innerText = '';
        
        let time = 8;
        let itv = setInterval(() => {
            time--; document.getElementById('crashVal').innerText = time + 's';
            if(time <= 0) { clearInterval(itv); startCrash(); }
        }, 1000);
    }

    function startCrash() {
        crash.active = true;
        cvs.width = cvs.offsetWidth; cvs.height = cvs.offsetHeight;
        let end = Math.random() < 0.1 ? 1.0 : (Math.random() * 4 + 1.1);
        let start = Date.now();
        
        if(crash.bet > 0) {
            document.getElementById('crashBtn').innerText = "–ó–ê–ë–†–ê–¢–¨";
            document.getElementById('crashBtn').className = 'btn btn-green';
        }

        let loop = setInterval(() => {
            let now = (Date.now() - start) / 1000;
            crash.mult = Math.pow(1.08, now).toFixed(2);
            
            ctx.clearRect(0,0,cvs.width, cvs.height);
            ctx.strokeStyle = '#00f2ff'; ctx.lineWidth = 5;
            let x = (now / 10) * cvs.width;
            let y = cvs.height - ((crash.mult - 1) / 4) * cvs.height;
            crash.pts.push({x, y});
            ctx.beginPath(); ctx.moveTo(0, cvs.height);
            crash.pts.forEach(p => ctx.lineTo(p.x, p.y)); ctx.stroke();

            if(crash.mult >= end) {
                clearInterval(loop); crash.active = false;
                document.getElementById('crashVal').innerText = 'BOOM!';
                sfx(100, 'sawtooth'); crash.bet = 0; setTimeout(initCrash, 3000);
            } else {
                document.getElementById('crashVal').innerText = crash.mult + 'x';
                if(crash.bet > 0 && !crash.cashed) {
                    document.getElementById('crashProfit').innerText = '+' + Math.floor(crash.bet * crash.mult) + ' ‚ÇΩ';
                    if(parseFloat(document.getElementById('crashAuto').value) <= crash.mult) doCrashAction();
                }
            }
        }, 60);
    }

    function doCrashAction() {
        if(!crash.active) {
            const b = parseInt(document.getElementById('crashBet').value);
            if(b > 0 && b <= userData.balance) {
                crash.bet = b; db.ref('users/'+user+'/balance').transaction(v => v - b);
                document.getElementById('crashBtn').innerText = "–ü–†–ò–ù–Ø–¢–û"; document.getElementById('crashBtn').disabled = true;
                sfx(400);
            }
        } else if(crash.bet > 0 && !crash.cashed) {
            crash.cashed = true;
            let win = Math.floor(crash.bet * crash.mult);
            db.ref('users/'+user).transaction(u => { u.balance += win; u.xp += 20; return u; });
            document.getElementById('crashBtn').innerText = "–í–´–í–û–î"; document.getElementById('crashBtn').disabled = true;
            sfx(800);
        }
    }

    // --- MINES ---
    function startMines() {
        const b = parseInt(document.getElementById('minesBet').value);
        if(b > 0 && b <= userData.balance) {
            db.ref('users/'+user+'/balance').transaction(v => v - b);
            mines.active = true; mines.bet = b; mines.open = 0;
            mines.total = parseInt(document.getElementById('minesCount').value);
            mines.bombs = []; while(mines.bombs.length < mines.total) {
                let r = Math.floor(Math.random()*25); if(!mines.bombs.includes(r)) mines.bombs.push(r);
            }
            const g = document.getElementById('minesGrid'); g.innerHTML = '';
            for(let i=0; i<25; i++) {
                const c = document.createElement('div'); c.className = 'cell';
                c.onclick = () => {
                    if(!mines.active || c.classList.contains('active')) return;
                    if(mines.bombs.includes(i)) {
                        mines.active = false; c.classList.add('death'); c.innerText = 'üí£';
                        sfx(150, 'sawtooth'); setTimeout(() => { alert("–ë–ê-–ë–ê–•!"); g.innerHTML = ''; resetMines(); }, 500);
                    } else {
                        c.classList.add('active'); c.innerText = 'üíé'; mines.open++;
                        sfx(600 + (mines.open * 50));
                        let m = (1 + (mines.open * (mines.total/4))).toFixed(2);
                        document.getElementById('minesAction').innerText = `–ó–ê–ë–†–ê–¢–¨ (${m}x)`;
                    }
                };
                g.appendChild(c);
            }
            document.getElementById('minesAction').innerText = "–ó–ê–ë–†–ê–¢–¨ (1.00x)";
            document.getElementById('minesAction').onclick = () => {
                if(!mines.active || mines.open === 0) return;
                let win = Math.floor(mines.bet * (1 + (mines.open * (mines.total/4))));
                db.ref('users/'+user).transaction(u => { u.balance += win; u.xp += 15; return u; });
                g.innerHTML = ''; resetMines(); sfx(900);
            };
        }
    }
    function resetMines() { 
        mines.active = false; document.getElementById('minesAction').innerText = "–ò–ì–†–ê–¢–¨";
        document.getElementById('minesAction').onclick = startMines;
    }

    // --- LADDER ---
    function startLadder() {
        const b = parseInt(document.getElementById('ladderBet').value);
        if(b > 0 && b <= userData.balance) {
            db.ref('users/'+user+'/balance').transaction(v => v - b);
            ladder.active = true; ladder.bet = b; ladder.step = 0;
            const g = document.getElementById('ladderGame'); g.innerHTML = '';
            for(let i=0; i<8; i++) {
                const r = document.createElement('div'); r.style = "display:flex; gap:10px;";
                for(let j=0; j<2; j++) {
                    const s = document.createElement('div'); s.className = 'cell';
                    s.style = "width:80px; height:40px;";
                    if(i === 0) s.onclick = () => stepLadder(j, s, i);
                    else s.style.opacity = "0.2";
                    r.appendChild(s);
                }
                g.appendChild(r);
            }
            document.getElementById('ladderBtn').innerText = "–ó–ê–ë–†–ê–¢–¨ (1.00x)";
            document.getElementById('ladderBtn').onclick = cashLadder;
        }
    }

    function stepLadder(choice, el, idx) {
        if(!ladder.active || idx !== ladder.step) return;
        if(Math.random() < 0.5) {
            ladder.active = false; el.classList.add('death'); sfx(150, 'sawtooth');
            setTimeout(() => { alert("–£–ü–ê–õ!"); startLadder(); resetLadder(); }, 500);
        } else {
            el.classList.add('active'); ladder.step++;
            sfx(600 + (ladder.step * 60));
            let m = Math.pow(1.8, ladder.step).toFixed(2);
            document.getElementById('ladderBtn').innerText = `–ó–ê–ë–†–ê–¢–¨ (${m}x)`;
            const rows = document.getElementById('ladderGame').children;
            if(ladder.step < 8) {
                Array.from(rows[ladder.step].children).forEach((c, i) => {
                    c.style.opacity = "1"; c.onclick = () => stepLadder(i, c, ladder.step);
                });
            }
        }
    }

    function cashLadder() {
        if(!ladder.active) return;
        let win = Math.floor(ladder.bet * Math.pow(1.8, ladder.step));
        db.ref('users/'+user).transaction(u => { u.balance += win; u.xp += 40; return u; });
        resetLadder(); sfx(900);
    }
    function resetLadder() {
        ladder.active = false; document.getElementById('ladderBtn').innerText = "–°–¢–ê–†–¢";
        document.getElementById('ladderBtn').onclick = startLadder;
    }

    // --- OTHER ---
    function manualClick() {
        sfx(400);
        db.ref('users/'+user).transaction(u => {
            if(u) {
                u.balance += (u.lvl * 2.5); u.xp += 10;
                if(u.xp >= u.lvl * 1000) { u.lvl++; u.xp = 0; showLvl(u.lvl); }
            }
            return u;
        });
    }

    function showLvl(n) {
        const p = document.getElementById('lvlPopup'); document.getElementById('lvlNum').innerText = n;
        p.style.display = 'flex'; sfx(1000, 'square', 0.8); setTimeout(() => p.style.display='none', 3000);
    }

    function renderGpus() {
        const c = document.getElementById('gpuList'); c.innerHTML = '';
        GPUS.forEach(g => {
            const have = (userData.gpus && userData.gpus[g.id]) || 0;
            c.innerHTML += `<div class="panel" style="flex-direction:row; padding:15px; justify-content:space-between; align-items:center;">
                <div style="text-align:left"><b style="color:var(--accent)">${g.n}</b><br><small>+${g.i}‚ÇΩ/—Å | –£ –≤–∞—Å: ${have}</small></div>
                <button class="btn btn-outline" style="padding:10px 20px;" onclick="buyGpu('${g.id}', ${g.p})">${g.p/1000}k ‚ÇΩ</button>
            </div>`;
        });
    }

    function buyGpu(id, p) {
        if(userData.balance >= p) {
            db.ref('users/'+user).transaction(u => {
                if(u) { u.balance -= p; if(!u.gpus) u.gpus={}; u.gpus[id] = (u.gpus[id]||0)+1; }
                return u;
            });
            sfx(1100); setTimeout(renderGpus, 200);
        } else toast("–ú–∞–ª–æ –¥–µ–Ω–µ–≥!");
    }

    function openCase(p, max) {
        if(userData.balance < p) return toast("–ú–∞–ª–æ –¥–µ–Ω–µ–≥!");
        db.ref('users/'+user+'/balance').transaction(b => b - p);
        const r = document.getElementById('caseRes'); r.innerText = "–û–¢–ö–†–´–¢–ò–ï...";
        setTimeout(() => {
            let win = Math.floor(Math.random() * max);
            db.ref('users/'+user).transaction(u => { u.balance += win; u.xp += 50; return u; });
            r.innerText = win.toLocaleString() + " ‚ÇΩ";
            sfx(win > p ? 1000 : 300);
        }, 1500);
    }

    function sendChat() {
        const t = document.getElementById('chatIn').value.trim();
        if(t && user) {
            db.ref('chat').push().set({ u: user, t: ": " + t });
            document.getElementById('chatIn').value = '';
        }
    }

    function updateTop() {
        db.ref('users').orderByChild('balance').limitToLast(10).on('value', s => {
            const l = document.getElementById('topList'); l.innerHTML = '';
            let arr = []; s.forEach(u => arr.push({n:u.key, b:u.val().balance}));
            arr.reverse().forEach((u, i) => {
                l.innerHTML += `<div class="chat-msg" style="display:flex; justify-content:space-between;">
                    <span>#${i+1} ${u.n}</span><b>${Math.floor(u.b).toLocaleString()} ‚ÇΩ</b>
                </div>`;
            });
        });
    }

    function showTab(el, id) {
        document.querySelectorAll('.nav-link, .content').forEach(x => x.classList.remove('active'));
        el.classList.add('active'); document.getElementById(id).classList.add('active');
        if(id === 'tabMining') renderGpus();
    }
</script>
</body>
</html>
