<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TORNADO V5.4 | TABS FIXED</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #00e5ff; --pink: #ff0055; --bg: #06080c; --card: rgba(15, 20, 28, 0.9); --border: rgba(255, 255, 255, 0.08); }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden; }
        
        .app { display: grid; grid-template-columns: 1fr 380px; gap: 15px; width: 98vw; height: 92vh; max-width: 1400px; }
        .glass { background: var(--card); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 24px; overflow: hidden; display: flex; flex-direction: column; }
        
        /* Вкладки */
        .nav { display: flex; background: rgba(0,0,0,0.5); padding: 8px; gap: 5px; border-bottom: 1px solid var(--border); }
        .tab { 
            flex: 1; padding: 12px; text-align: center; cursor: pointer; 
            font-size: 11px; font-weight: 800; color: #64748b; border-radius: 10px; 
            text-transform: uppercase; transition: all 0.3s ease;
        }
        .tab.active { color: var(--accent); background: rgba(0, 229, 255, 0.1); box-shadow: 0 0 15px rgba(0, 229, 255, 0.1); }
        .tab:hover:not(.active) { color: #fff; background: rgba(255,255,255,0.05); }

        /* Контент разделов */
        .section { display: none; padding: 25px; flex-direction: column; gap: 15px; flex: 1; animation: fadeIn 0.3s ease; }
        .section.active { display: flex; } /* Показываем только активный */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Crash */
        #crash-area { background: rgba(0,0,0,0.5); border-radius: 18px; height: 280px; width: 100%; margin-bottom: 20px; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid var(--border); }
        .multiplier { font-family: 'Orbitron'; font-size: 4.5rem; font-weight: 900; color: var(--accent); }
        #crash-timer { font-family: 'Orbitron'; color: #64748b; font-size: 1rem; margin-top: 10px; }

        .btn { border: none; padding: 18px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.2s; text-transform: uppercase; width: 100%; font-family: 'Inter'; }
        .btn-main { background: var(--accent); color: #000; box-shadow: 0 0 20px rgba(0, 229, 255, 0.2); }
        .btn-pink { background: var(--pink); color: #fff; }
        .btn:disabled { background: #1a1f26; color: #444; cursor: not-allowed; box-shadow: none; }

        .balance-card { padding: 25px; text-align: center; border-bottom: 1px solid var(--border); }
        .bal-val { font-family: 'Orbitron'; font-size: 2.8rem; font-weight: 900; color: var(--accent); }
        
        .chat-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 12px; border: 1px solid var(--border); font-size: 13px; }
        .msg b { color: var(--accent); font-size: 10px; display: block; }
        
        input { background: rgba(0,0,0,0.6); border: 1px solid var(--border); padding: 14px; border-radius: 10px; color: #fff; outline: none; width: 100%; box-sizing: border-box; }
        #auth-box { width: 380px; padding: 40px; text-align: center; }
    </style>
</head>
<body>

<div class="glass" id="auth-box">
    <h1 style="font-family: 'Orbitron'; color: var(--accent); margin: 0;">TORNADO</h1>
    <p style="font-size: 10px; color: #64748b; margin-bottom: 30px;">V5.4 TABS SYSTEM</p>
    <input type="text" id="auth-user" placeholder="ЛОГИН" style="margin-bottom: 12px;">
    <input type="password" id="auth-pass" placeholder="ПАРОЛЬ" style="margin-bottom: 25px;">
    <button class="btn btn-main" onclick="handleAuth()">ВХОД / РЕГИСТРАЦИЯ</button>
</div>

<div class="app" id="main-app" style="display: none;">
    <div class="glass">
        <div class="nav">
            <div class="tab active" data-target="tab-crash" onclick="switchTab(this)">КРАШ</div>
            <div class="tab" data-target="tab-duel" onclick="switchTab(this)">ДУЭЛИ</div>
            <div class="tab" data-target="tab-mine" onclick="switchTab(this)">МАЙНИНГ</div>
        </div>

        <div id="tab-crash" class="section active">
            <div id="crash-area">
                <div class="multiplier" id="crash-mult">1.00x</div>
                <div id="crash-timer">ОЖИДАНИЕ...</div>
            </div>
            <div style="display: flex; gap: 12px;">
                <input type="number" id="crash-bet" placeholder="Сумма ставки">
                <button id="crash-btn" class="btn btn-main" onclick="crashAction()">СТАВКА</button>
            </div>
        </div>

        <div id="tab-duel" class="section">
            <h3 style="font-family: 'Orbitron'; font-size: 1rem; color: var(--accent);">PVP ДУЭЛИ</h3>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="duel-bet" placeholder="Ставка вызова">
                <button class="btn btn-main" onclick="createDuel()" style="width: 150px;">ВЫЗВАТЬ</button>
            </div>
            <div id="duel-list" style="margin-top: 15px; overflow-y: auto; flex: 1;">
                </div>
        </div>

        <div id="tab-mine" class="section" style="align-items: center; justify-content: center;">
            <p style="color: #64748b; font-size: 12px;">ЖМИ НА КНОПКУ — ПОЛУЧАЙ 1₽</p>
            <button class="btn btn-main" style="width: 220px; height: 220px; border-radius: 50%; font-size: 4rem; font-family: 'Orbitron';" onclick="mineClick()">T</button>
        </div>
    </div>

    <div class="glass">
        <div class="balance-card">
            <span class="bal-val"><span id="user-balance">0</span><small style="font-size: 1rem; margin-left: 5px;">₽</small></span>
        </div>
        <div class="chat-area" id="chat-box"></div>
        <div style="padding: 20px; display: flex; gap: 10px; background: rgba(0,0,0,0.2);">
            <input type="text" id="chat-input" placeholder="Чат...">
            <button class="btn btn-main" style="width: 60px;" onclick="sendChat()">></button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC8UkaoaI7nHRSxNPddRwXnNxzHX7kt8s8",
        authDomain: "tornadogame-41ae2.firebaseapp.com",
        databaseURL: "https://tornadogame-41ae2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "tornadogame-41ae2",
        storageBucket: "tornadogame-41ae2.firebasestorage.app",
        messagingSenderId: "926174944730",
        appId: "1:926174944730:web:20be5b57efb23ab853b4e3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const sfx = {
        click: new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3'),
        win: new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'),
        loss: new Audio('https://assets.mixkit.co/active_storage/sfx/2511/2511-preview.mp3')
    };

    let user = null, balance = 0, crashState = 'waiting', currentMult = 1.0, myBet = 0, isCashedOut = false;

    // ФУНКЦИЯ ПЕРЕКЛЮЧЕНИЯ ВКЛАДОК
    function switchTab(clickedTab) {
        // Убираем активный класс у всех вкладок
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        // Скрываем все секции
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        
        // Активируем нужную вкладку
        clickedTab.classList.add('active');
        // Показываем нужную секцию
        const targetId = clickedTab.getAttribute('data-target');
        document.getElementById(targetId).classList.add('active');
        
        sfx.click.play();
    }

    function handleAuth() {
        const u = document.getElementById('auth-user').value.trim().toLowerCase();
        const p = document.getElementById('auth-pass').value.trim();
        if(u.length < 3) return;
        db.ref('users/'+u).once('value', s => {
            if(s.exists()) {
                if(s.val().pass === p) startApp(u); else alert("Пароль!");
            } else {
                db.ref('users/'+u).set({pass:p, balance:1000}).then(()=>startApp(u));
            }
        });
    }

    function startApp(u) {
        user = u;
        document.getElementById('auth-box').style.display = 'none';
        document.getElementById('main-app').style.display = 'grid';
        
        db.ref('users/'+user+'/balance').on('value', s => {
            balance = s.val() || 0;
            document.getElementById('user-balance').innerText = balance.toLocaleString();
        });

        db.ref('chat').limitToLast(20).on('child_added', s => {
            const m = s.val();
            const d = document.createElement('div'); d.className = 'msg';
            d.innerHTML = `<b>${m.user}</b> ${m.text}`;
            const b = document.getElementById('chat-box');
            b.appendChild(d); b.scrollTop = b.scrollHeight;
        });

        initCrashCycle();
        initDuels();
    }

    // КРАШ ЛОГИКА
    function initCrashCycle() {
        if (crashState !== 'waiting') return;
        let timeLeft = 8;
        const timerLabel = document.getElementById('crash-timer');
        const countdown = setInterval(() => {
            timeLeft--;
            timerLabel.innerText = `СТАРТ ЧЕРЕЗ: ${timeLeft}С`;
            if (timeLeft <= 0) {
                clearInterval(countdown);
                startCrashRise();
            }
        }, 1000);
    }

    function startCrashRise() {
        crashState = 'rising'; isCashedOut = false;
        document.getElementById('crash-timer').innerText = "ГРАФИК РАСТЕТ!";
        const btn = document.getElementById('crash-btn');
        if (myBet > 0) { btn.innerText = "ЗАБРАТЬ"; btn.classList.add('btn-pink'); btn.disabled = false; }
        else { btn.innerText = "ИГРА ИДЕТ..."; btn.disabled = true; }

        let crashPoint = (Math.random() * 4 + 1.1).toFixed(2);
        let riseInterval = setInterval(() => {
            if (currentMult >= crashPoint) { clearInterval(riseInterval); doCrash(); }
            else {
                currentMult = (parseFloat(currentMult) + 0.01).toFixed(2);
                document.getElementById('crash-mult').innerText = currentMult + 'x';
            }
        }, 80);
    }

    function doCrash() {
        crashState = 'crashed';
        document.getElementById('crash-mult').innerText = "CRASH!";
        document.getElementById('crash-mult').style.color = 'var(--pink)';
        const btn = document.getElementById('crash-btn');
        btn.innerText = "ВЗРЫВ"; btn.disabled = true; btn.classList.remove('btn-pink');
        sfx.loss.play();
        myBet = 0;
        setTimeout(() => {
            crashState = 'waiting'; currentMult = 1.0;
            document.getElementById('crash-mult').innerText = "1.00x";
            document.getElementById('crash-mult').style.color = 'var(--accent)';
            document.getElementById('crash-btn').innerText = "СТАВКА";
            document.getElementById('crash-btn').disabled = false;
            initCrashCycle();
        }, 4000);
    }

    function crashAction() {
        const amt = parseInt(document.getElementById('crash-bet').value);
        if (crashState === 'waiting' && myBet === 0) {
            if (amt > 0 && amt <= balance) {
                myBet = amt; db.ref('users/'+user+'/balance').set(balance - amt);
                document.getElementById('crash-btn').innerText = "СТАВКА ПРИНЯТА";
                document.getElementById('crash-btn').disabled = true;
            }
        } else if (crashState === 'rising' && myBet > 0 && !isCashedOut) {
            isCashedOut = true;
            let win = Math.floor(myBet * currentMult);
            db.ref('users/'+user+'/balance').set(balance + win);
            myBet = 0;
            const btn = document.getElementById('crash-btn');
            btn.innerText = "ЗАБРАНО!"; btn.disabled = true; btn.classList.remove('btn-pink');
            sfx.win.play();
        }
    }

    // ДУЭЛИ
    function initDuels() {
        db.ref('duels').on('value', s => {
            const l = document.getElementById('duel-list'); l.innerHTML = '';
            s.forEach(d => {
                const data = d.val(); if(data.creator === user) return;
                const dv = document.createElement('div'); dv.className = 'msg';
                dv.style.display = 'flex'; dv.style.justifyContent = 'space-between';
                dv.innerHTML = `<span>⚔️ ${data.creator} [${data.bet}₽]</span> <button class="btn btn-main" style="width:80px; padding:8px; font-size:10px" onclick="acceptDuel('${d.key}', ${data.bet}, '${data.creator}')">ИГРАТЬ</button>`;
                l.appendChild(dv);
            });
        });
    }

    function createDuel() {
        let amt = parseInt(document.getElementById('duel-bet').value);
        if(amt > 0 && amt <= balance) {
            db.ref('users/'+user+'/balance').set(balance - amt);
            db.ref('duels').push({creator: user, bet: amt});
        }
    }

    function acceptDuel(id, amt, creator) {
        if(balance < amt) return;
        db.ref('duels/'+id).remove().then(() => {
            db.ref('users/'+user+'/balance').set(balance - amt);
            let win = Math.random() > 0.5;
            let winner = win ? user : creator;
            db.ref('users/'+winner+'/balance').transaction(b => (b || 0) + (amt * 2));
            sfx.win.play();
            alert(win ? "ПОБЕДА!" : "ПРОИГРЫШ...");
        });
    }

    function mineClick() { db.ref('users/'+user+'/balance').set(balance + 1); sfx.click.play(); }
    function sendChat() {
        let t = document.getElementById('chat-input').value.trim();
        if(t) { db.ref('chat').push({user: user, text: t}); document.getElementById('chat-input').value = ''; }
    }
</script>
</body>
</html>