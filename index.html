<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TORNADO V9.8 | STAIRWAY FIX</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #00f2ff; --pink: #ff007b; --gold: #ffcc00; --green: #00ff88;
            --bg: #030507; --card: rgba(10, 15, 20, 0.98); --border: rgba(0, 242, 255, 0.2);
        }

        * { box-sizing: border-box; transition: 0.2s; outline: none; }
        body {
            font-family: 'Inter', sans-serif; background: var(--bg); color: #fff;
            margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }

        .app-container { display: grid; grid-template-columns: 1fr 400px; gap: 20px; width: 99vw; height: 98vh; max-width: 1800px; padding: 10px; }
        .glass-panel { background: var(--card); border: 1px solid var(--border); border-radius: 30px; display: flex; flex-direction: column; overflow: hidden; backdrop-filter: blur(25px); box-shadow: 0 20px 60px rgba(0,0,0,0.8); }

        /* Auth */
        #authBox { width: 480px; padding: 60px; text-align: center; position: absolute; z-index: 99999; border: 1px solid var(--accent); }
        .auth-nav { display: flex; gap: 10px; margin-bottom: 30px; background: rgba(0,0,0,0.5); padding: 5px; border-radius: 15px; }
        .auth-tab { flex: 1; padding: 12px; border-radius: 12px; cursor: pointer; font-size: 11px; font-weight: 900; color: #5d727b; text-transform: uppercase; }
        .auth-tab.active { background: var(--accent); color: #000; }

        /* Nav */
        .sidebar-nav { display: flex; background: rgba(0,0,0,0.5); padding: 15px; gap: 8px; border-bottom: 1px solid var(--border); overflow-x: auto; scrollbar-width: none; }
        .nav-btn { padding: 12px 22px; border-radius: 15px; cursor: pointer; font-size: 10px; font-weight: 800; text-transform: uppercase; color: #5d727b; white-space: nowrap; border: 1px solid transparent; }
        .nav-btn.active { background: rgba(0, 242, 255, 0.1); color: var(--accent); border-color: var(--border); }

        .viewport { flex: 1; overflow-y: auto; padding: 30px; display: none; flex-direction: column; gap: 20px; }
        .viewport.active { display: flex; animation: viewIn 0.3s ease-out; }
        @keyframes viewIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Games Layout */
        .crash-area { height: 380px; background: #050709; border-radius: 25px; position: relative; overflow: hidden; border: 1px solid var(--border); }
        #crashCanvas { width: 100%; height: 100%; }
        .crash-info { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; z-index: 10; }
        #crashMult { font-family: 'Orbitron'; font-size: 5.5rem; font-weight: 900; text-shadow: 0 0 40px var(--accent); margin: 0; }
        
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; width: 100%; max-width: 600px; margin: 0 auto; padding: 20px; }
        .game-cell { aspect-ratio: 1; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 32px; transition: 0.15s; }
        .game-cell:hover { background: rgba(0, 242, 255, 0.1); transform: scale(1.05); }
        .game-cell.active { background: var(--accent); box-shadow: 0 0 30px var(--accent); color: #000; border: none; }
        .game-cell.death { background: var(--pink); box-shadow: 0 0 30px var(--pink); color: #fff; }
        .game-cell.disabled { opacity: 0.1; cursor: default; filter: grayscale(1); }

        /* UI */
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .field { background: rgba(0,0,0,0.6); border: 1px solid var(--border); padding: 18px; border-radius: 20px; color: #fff; font-family: 'Orbitron'; font-size: 16px; width: 100%; }
        .btn-ui { border: none; padding: 20px; border-radius: 20px; font-weight: 900; cursor: pointer; text-transform: uppercase; font-family: 'Orbitron'; font-size: 13px; letter-spacing: 1px; }
        .btn-accent { background: linear-gradient(135deg, var(--accent), #0072ff); color: #000; }
        .btn-green { background: linear-gradient(135deg, var(--green), #00b35d); color: #000; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: #fff; }

        /* Stats */
        .user-block { padding: 30px; text-align: center; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(0,242,255,0.05) 0%, transparent 100%); }
        .bal-display { font-family: 'Orbitron'; font-size: 2.5rem; font-weight: 900; color: var(--accent); }
        .xp-line { height: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; margin: 15px 0; }
        .xp-bar { height: 100%; width: 0%; background: var(--accent); box-shadow: 0 0 10px var(--accent); transition: 0.5s; }

        /* Chat */
        .chat-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; background: rgba(0,0,0,0.2); }
        #chatBox { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; scroll-behavior: smooth; }
        .msg { background: rgba(255,255,255,0.04); padding: 12px 18px; border-radius: 18px; font-size: 14px; border-left: 4px solid var(--accent); align-self: flex-start; max-width: 90%; }
        .msg b { color: var(--accent); font-family: 'Orbitron'; font-size: 10px; display: block; margin-bottom: 4px; }

        /* Ladder UI Fix */
        .ladder-row { display: flex; gap: 15px; padding: 5px; justify-content: center; }
        .ladder-cell { width: 120px; height: 45px; border-radius: 12px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 900; font-family: 'Orbitron'; }
        .ladder-cell.active { background: var(--accent); color: #000; box-shadow: 0 0 15px var(--accent); }
        .ladder-cell.death { background: var(--pink); color: #fff; }

        #notif { position: fixed; top: 20px; right: 20px; z-index: 999999; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: #111; border: 1px solid var(--accent); padding: 15px 25px; border-radius: 15px; animation: slideIn 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(120%); } to { transform: translateX(0); } }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
    </style>
</head>
<body>

<div id="notif"></div>

<div id="authBox" class="glass-panel">
    <h1 style="font-family:'Orbitron'; font-size: 2.5rem; margin:0; color:var(--accent);">TORNADO</h1>
    <p style="letter-spacing: 8px; font-size: 10px; color: #5d727b; margin-bottom: 30px;">ULTRA STABLE V9.8</p>
    <div class="auth-nav">
        <div class="auth-tab active" id="tabLogin" onclick="setAuth('login')">–í—Ö–æ–¥</div>
        <div class="auth-tab" id="tabReg" onclick="setAuth('reg')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
    </div>
    <input type="text" id="authUser" placeholder="–õ–û–ì–ò–ù" class="field" style="margin-bottom: 15px;">
    <input type="password" id="authPass" placeholder="–ü–ê–†–û–õ–¨" class="field" style="margin-bottom: 25px;">
    <button class="btn-ui btn-accent" style="width:100%" onclick="handleAuth()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>
</div>

<div class="app-container" id="mainApp" style="display: none;">
    <div class="glass-panel">
        <div class="sidebar-nav">
            <div class="nav-btn active" onclick="showTab(this, 'viewCrash')">CRASH</div>
            <div class="nav-btn" onclick="showTab(this, 'viewMines')">MINES</div>
            <div class="nav-btn" onclick="showTab(this, 'viewLadder')">LADDER</div>
            <div class="nav-btn" onclick="showTab(this, 'viewMining')">MINING</div>
            <div class="nav-btn" onclick="showTab(this, 'viewCases')">CASES</div>
            <div class="nav-btn" onclick="showTab(this, 'viewTop')">LEADERS</div>
        </div>

        <div id="viewCrash" class="viewport active">
            <div class="crash-area">
                <canvas id="crashCanvas"></canvas>
                <div class="crash-info">
                    <div id="crashMult">1.00x</div>
                    <div id="crashProfit" style="color:var(--green); font-family:'Orbitron'; font-size:1.5rem; height:30px;"></div>
                </div>
            </div>
            <div class="input-row">
                <input type="number" id="betCrash" placeholder="–°–¢–ê–í–ö–ê" class="field">
                <input type="number" id="autoCrash" placeholder="–ê–í–¢–û (1.5)" class="field">
            </div>
            <button id="btnCrash" class="btn-ui btn-accent" onclick="actionCrash()">–ü–û–°–¢–ê–í–ò–¢–¨</button>
        </div>

        <div id="viewMines" class="viewport">
            <div class="input-row">
                <input type="number" id="betMines" placeholder="–°–¢–ê–í–ö–ê" class="field">
                <select id="cntMines" class="field" style="background:#000;">
                    <option value="3">3 –ú–ò–ù–´</option>
                    <option value="10">10 –ú–ò–ù</option>
                    <option value="24">24 –ú–ò–ù–´</option>
                </select>
            </div>
            <div id="gridMines" class="mines-grid"></div>
            <button id="btnMines" class="btn-ui btn-accent" onclick="startMines()">–ò–ì–†–ê–¢–¨</button>
        </div>

        <div id="viewLadder" class="viewport">
            <div class="input-row" style="grid-template-columns: 1fr 1fr 1fr;">
                <input type="number" id="betLadder" placeholder="–°–¢–ê–í–ö–ê" class="field">
                <select id="stepLadder" class="field" style="background:#000;">
                    <option value="5">5 –≠–¢–ê–ñ–ï–ô</option>
                    <option value="8" selected>8 –≠–¢–ê–ñ–ï–ô</option>
                    <option value="11">11 –≠–¢–ê–ñ–ï–ô</option>
                </select>
                <button id="startLadder" class="btn-ui btn-accent" onclick="initLadder()">–°–¢–ê–†–¢</button>
            </div>
            <div id="areaLadder" style="display:flex; flex-direction:column-reverse; gap:8px; margin-top:20px;"></div>
        </div>

        <div id="viewMining" class="viewport">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <button class="btn-ui btn-accent" style="height:150px;" onclick="clickFarm()">–ö–õ–ò–ö–ê–¢–¨<br><span id="valClick"></span></button>
                <div class="glass-panel" style="justify-content:center; align-items:center;">
                    <p style="font-size:10px; color:#5d727b;">–ü–ê–†–ò–¢–ï–¢ –î–û–•–û–î–ê</p>
                    <h2 id="valPassive" style="color:var(--green);">0 ‚ÇΩ</h2>
                </div>
            </div>
            <div id="listGPU" style="margin-top:20px;"></div>
        </div>

        <div id="viewCases" class="viewport">
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:20px;">
                <div class="glass-panel" style="padding:25px; text-align:center;">
                    <h3>–ë–†–û–î–Ø–ì–ê</h3><button id="caseBtn1" class="btn-ui btn-outline" style="width:100%" onclick="openBox(1000, 200, 5000, 'caseBtn1')">1,000 ‚ÇΩ</button>
                </div>
                <div class="glass-panel" style="padding:25px; text-align:center; border-color:var(--accent);">
                    <h3>–ú–ê–ì–ù–ê–¢</h3><button id="caseBtn2" class="btn-ui btn-accent" style="width:100%" onclick="openBox(30000, 10000, 150000, 'caseBtn2')">30,000 ‚ÇΩ</button>
                </div>
            </div>
            <h1 id="boxRes" style="text-align:center; font-family:'Orbitron'; margin-top:50px; font-size:3rem;"></h1>
        </div>

        <div id="viewTop" class="viewport"><h1 style="font-family:'Orbitron'; text-align:center;">LEADERS</h1><div id="listTop"></div></div>
    </div>

    <div class="glass-panel">
        <div class="user-block">
            <div class="bal-display" id="uBalance">0 ‚ÇΩ</div>
            <div class="xp-line"><div class="xp-bar" id="uBar"></div></div>
            <div style="display:flex; justify-content:space-between; font-size:10px; color:#5d727b;"><span id="uLevel"></span><span id="uXP"></span></div>
        </div>
        <div class="chat-container">
            <div id="chatBox"></div>
            <div style="padding:20px; display:flex; gap:10px;"><input type="text" id="chatInput" placeholder="–ß–∞—Ç..." class="field"><button class="btn-ui btn-accent" onclick="sendMsg()">></button></div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyC8UkaoaI7nHRSxNPddRwXnNxzHX7kt8s8",
        authDomain: "tornadogame-41ae2.firebaseapp.com",
        databaseURL: "https://tornadogame-41ae2-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "tornadogame-41ae2",
        appId: "1:926174944730:web:20be5b57efb23ab853b4e3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let user = null, userData = {}, authMode = 'login', audio;
    let crash = { active: false, mult: 1.0, bet: 0, cashed: false, pts: [] };
    let mines = { active: false, bet: 0, bombs: [], open: 0, total: 3 };
    let ladder = { active: false, bet: 0, step: 0, max: 8 };
    let isCaseOpening = false;

    const GPUS = [{id:'g1', n:'GTX 1050', p:15000, i:15},{id:'g2', n:'RTX 2060', p:80000, i:110},{id:'g3', n:'RTX 3080', p:450000, i:600},{id:'g4', n:'RTX 4090', p:1500000, i:2500},{id:'g5', n:'TESLA V100', p:8000000, i:15000}];

    function sfx(f, t='sine', d=0.15, v=0.07) {
        if(!audio) audio = new (window.AudioContext || window.webkitAudioContext)();
        const o = audio.createOscillator(); const g = audio.createGain();
        o.type = t; o.frequency.setValueAtTime(f, audio.currentTime);
        g.gain.setValueAtTime(v, audio.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, audio.currentTime + d);
        o.connect(g); g.connect(audio.destination); o.start(); o.stop(audio.currentTime + d);
    }

    function toast(t) {
        const b = document.getElementById('notif'); const e = document.createElement('div');
        e.className = 'toast'; e.innerText = t; b.appendChild(e); setTimeout(() => e.remove(), 3000);
    }

    function setAuth(m) { authMode = m; document.getElementById('tabLogin').classList.toggle('active', m==='login'); document.getElementById('tabReg').classList.toggle('active', m==='reg'); }

    function handleAuth() {
        const u = document.getElementById('authUser').value.trim().toLowerCase();
        const p = document.getElementById('authPass').value.trim();
        if(u.length < 3) return toast("–ö–æ—Ä–æ—Ç–∫–∏–π –ª–æ–≥–∏–Ω");
        db.ref('users/'+u).once('value', s => {
            if(authMode==='login') { if(s.exists() && s.val().pass===p) run(u); else toast("–û—à–∏–±–∫–∞!"); }
            else { if(s.exists()) toast("–ó–∞–Ω—è—Ç!"); else db.ref('users/'+u).set({pass:p, balance:10000, xp:0, lvl:1}).then(()=>run(u)); }
        });
    }

    function run(id) {
        user = id; document.getElementById('authBox').style.display = 'none'; document.getElementById('mainApp').style.display = 'grid';
        db.ref('users/'+user).on('value', s => { userData = s.val(); updateUI(); });
        db.ref('chat').limitToLast(20).on('value', s => {
            const b = document.getElementById('chatBox'); b.innerHTML = '';
            s.forEach(m => { b.innerHTML += `<div class="msg"><b>${m.val().u}</b>${m.val().t}</div>`; });
            b.scrollTop = b.scrollHeight;
        });
        initCrash(); syncTop();
        setInterval(() => {
            let inc = 0; if(userData.gpus) GPUS.forEach(g => inc += (userData.gpus[g.id]||0)*g.i);
            if(inc > 0) db.ref('users/'+user+'/balance').transaction(b => b + inc);
        }, 1000);
    }

    function updateUI() {
        document.getElementById('uBalance').innerText = Math.floor(userData.balance).toLocaleString() + ' ‚ÇΩ';
        document.getElementById('uLevel').innerText = 'LVL ' + userData.lvl;
        document.getElementById('uXP').innerText = `${userData.xp} / ${userData.lvl*1000}`;
        document.getElementById('uBar').style.width = (userData.xp / (userData.lvl*1000) * 100) + '%';
        document.getElementById('valClick').innerText = `+${(userData.lvl*2.5).toFixed(1)} ‚ÇΩ`;
    }

    // --- CRASH ---
    const cvs = document.getElementById('crashCanvas'); const ctx = cvs.getContext('2d');
    function initCrash() {
        crash.active = false; crash.mult = 1.0; document.getElementById('btnCrash').innerText = "–°–¢–ê–í–ö–ê";
        document.getElementById('btnCrash').className = 'btn-ui btn-accent';
        let t = 8; let itv = setInterval(() => {
            t--; document.getElementById('crashMult').innerText = t + 's';
            if(t <= 0) { clearInterval(itv); startCrash(); }
        }, 1000);
    }
    function startCrash() {
        crash.active = true; let boom = (Math.random()*5 + 1.1); let start = Date.now();
        if(crash.bet > 0) { document.getElementById('btnCrash').innerText = "–í–´–í–û–î"; document.getElementById('btnCrash').className = 'btn-ui btn-green'; }
        let loop = setInterval(() => {
            crash.mult = Math.pow(1.07, (Date.now()-start)/1000).toFixed(2);
            document.getElementById('crashMult').innerText = crash.mult + 'x';
            if(crash.mult >= boom) { clearInterval(loop); crash.active = false; document.getElementById('crashMult').innerText = 'BOOM!'; crash.bet=0; setTimeout(initCrash, 3000); }
        }, 50);
    }
    function actionCrash() {
        if(!crash.active) {
            let b = parseInt(document.getElementById('betCrash').value);
            if(b>0 && b<=userData.balance) { crash.bet = b; db.ref('users/'+user+'/balance').transaction(v => v-b); }
        } else if(crash.bet > 0 && !crash.cashed) {
            crash.cashed = true; let w = Math.floor(crash.bet * crash.mult);
            db.ref('users/'+user).transaction(u => { u.balance+=w; u.xp+=30; return u; });
            document.getElementById('btnCrash').innerText = "–í–ó–Ø–¢–û";
        }
    }

    // --- LADDER FIXED LOGIC ---
    function initLadder() {
        let b = parseInt(document.getElementById('betLadder').value);
        if(b > 0 && b <= userData.balance) {
            db.ref('users/'+user+'/balance').transaction(v => v-b);
            ladder.active = true; ladder.bet = b; ladder.step = 0;
            ladder.max = parseInt(document.getElementById('stepLadder').value);
            const area = document.getElementById('areaLadder'); area.innerHTML = '';
            
            for(let i=0; i<ladder.max; i++) {
                const row = document.createElement('div'); row.className = 'ladder-row';
                row.id = `lad-row-${i}`;
                for(let j=0; j<2; j++) {
                    const cell = document.createElement('div'); cell.className = 'ladder-cell';
                    cell.innerText = '?';
                    if(i === 0) cell.onclick = () => stepLad(j, i, cell);
                    else cell.classList.add('disabled');
                    row.appendChild(cell);
                }
                area.appendChild(row);
            }
            document.getElementById('startLadder').innerText = "CASH (1.00x)";
            document.getElementById('startLadder').onclick = cashLad;
        }
    }

    function stepLad(choice, rowIndex, cellEl) {
        if(!ladder.active || rowIndex !== ladder.step) return;
        
        let isSafe = Math.random() > 0.45;
        if(!isSafe) {
            cellEl.classList.add('death'); cellEl.innerText = 'X';
            ladder.active = false; sfx(150, 'sawtooth');
            setTimeout(() => { toast("–£–ü–ê–õ!"); document.getElementById('areaLadder').innerHTML=''; resetLad(); }, 800);
        } else {
            cellEl.classList.add('active'); cellEl.innerText = 'OK';
            ladder.step++; sfx(500 + (ladder.step*40));
            let m = Math.pow(1.85, ladder.step).toFixed(2);
            document.getElementById('startLadder').innerText = `CASH (${m}x)`;
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Ä—è–¥
            if(ladder.step < ladder.max) {
                const nextRow = document.getElementById(`lad-row-${ladder.step}`);
                Array.from(nextRow.children).forEach(c => {
                    c.classList.remove('disabled');
                    c.onclick = () => stepLad(0, ladder.step, c);
                });
            } else { cashLad(); }
        }
    }

    function cashLad() {
        if(!ladder.active || ladder.step === 0) return;
        let w = Math.floor(ladder.bet * Math.pow(1.85, ladder.step));
        db.ref('users/'+user).transaction(u => { u.balance += w; u.xp += 50; return u; });
        toast(`+${w} ‚ÇΩ`); resetLad();
    }
    function resetLad() { ladder.active = false; document.getElementById('startLadder').innerText = "–°–¢–ê–†–¢"; document.getElementById('startLadder').onclick = initLadder; document.getElementById('areaLadder').innerHTML=''; }

    // --- MINES ---
    function startMines() {
        let b = parseInt(document.getElementById('betMines').value);
        if(b>0 && b<=userData.balance) {
            db.ref('users/'+user+'/balance').transaction(v => v-b);
            mines.active=true; mines.bet=b; mines.open=0; mines.total=parseInt(document.getElementById('cntMines').value);
            mines.bombs=[]; while(mines.bombs.length < mines.total) { let r=Math.floor(Math.random()*25); if(!mines.bombs.includes(r)) mines.bombs.push(r); }
            const g = document.getElementById('gridMines'); g.innerHTML = '';
            for(let i=0; i<25; i++) {
                const c = document.createElement('div'); c.className='game-cell';
                c.onclick=()=>{
                    if(!mines.active || c.classList.contains('active')) return;
                    if(mines.bombs.includes(i)) { c.classList.add('death'); c.innerText='üí£'; mines.active=false; setTimeout(()=>startMines(), 1000); }
                    else { c.classList.add('active'); c.innerText='üíé'; mines.open++; let m=(1+(mines.open*(mines.total/4))).toFixed(2); document.getElementById('btnMines').innerText=`–í–ó–Ø–¢–¨ (${m}x)`; }
                };
                g.appendChild(c);
            }
            document.getElementById('btnMines').onclick = () => {
                let w = Math.floor(mines.bet * (1+(mines.open*(mines.total/4))));
                db.ref('users/'+user).transaction(u=>{ u.balance+=w; u.xp+=20; return u; });
                g.innerHTML=''; document.getElementById('btnMines').innerText="–ò–ì–†–ê–¢–¨"; document.getElementById('btnMines').onclick=startMines;
            };
        }
    }

    // --- OTHER ---
    function openBox(cost, min, max, btn) {
        if(isCaseOpening || userData.balance < cost) return;
        isCaseOpening = true; document.getElementById(btn).disabled = true;
        db.ref('users/'+user+'/balance').transaction(b => b - cost);
        setTimeout(() => {
            let w = Math.floor(Math.random()*(max-min))+min;
            db.ref('users/'+user).transaction(u => { u.balance+=w; return u; });
            document.getElementById('boxRes').innerText = w + " ‚ÇΩ";
            isCaseOpening = false; document.getElementById(btn).disabled = false;
        }, 1200);
    }

    function clickFarm() { db.ref('users/'+user).transaction(u => { u.balance += (u.lvl*2.5); u.xp += 10; if(u.xp>=u.lvl*1000){u.lvl++; u.xp=0;} return u; }); }

    function sendMsg() { let t = document.getElementById('chatInput').value; if(t) { db.ref('chat').push().set({u:user, t:": "+t}); document.getElementById('chatInput').value=''; } }

    function syncTop() {
        db.ref('users').once('value', s => {
            const l = document.getElementById('listTop'); l.innerHTML = '';
            let us = []; s.forEach(u => { us.push({n:u.key, b:u.val().balance}); });
            us.sort((a,b)=>b.b-a.b).slice(0,10).forEach((u,i) => {
                l.innerHTML += `<div class="msg" style="width:100%">#${i+1} ${u.n} - ${Math.floor(u.b)} ‚ÇΩ</div>`;
            });
        });
    }

    function showTab(b, id) { document.querySelectorAll('.nav-btn, .viewport').forEach(x=>x.classList.remove('active')); b.classList.add('active'); document.getElementById(id).classList.add('active'); if(id==='viewMining') syncGPU(); }
    
    function syncGPU() {
        const c = document.getElementById('listGPU'); c.innerHTML = '';
        GPUS.forEach(g => {
            let h = (userData.gpus && userData.gpus[g.id]) || 0;
            c.innerHTML += `<div class="gpu-item"><div>${g.n} (x${h})</div><button class="btn-ui btn-outline" onclick="buyGPU('${g.id}', ${g.p})">${g.p} ‚ÇΩ</button></div>`;
        });
    }
    function buyGPU(id, p) { if(userData.balance>=p) db.ref('users/'+user).transaction(u => { u.balance-=p; if(!u.gpus)u.gpus={}; u.gpus[id]=(u.gpus[id]||0)+1; return u; }); }
</script>
</body>
</html>
